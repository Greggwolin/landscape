# Generated by Django 5.0.1 on 2025-11-23 21:54

import django.contrib.postgres.fields
import django.core.validators
import django.db.models.deletion
from decimal import Decimal
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):
    initial = True

    dependencies = [
        ("projects", "0002_add_vendor_contact_id"),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name="ActualItem",
            fields=[
                (
                    "actual_item_id",
                    models.AutoField(
                        db_column="fact_id", primary_key=True, serialize=False
                    ),
                ),
                ("category", models.CharField(max_length=50)),
                (
                    "subcategory",
                    models.CharField(blank=True, max_length=100, null=True),
                ),
                ("line_item_name", models.CharField(max_length=200)),
                (
                    "account_code",
                    models.CharField(blank=True, max_length=50, null=True),
                ),
                ("fiscal_year", models.IntegerField()),
                ("fiscal_period", models.SmallIntegerField(blank=True, null=True)),
                (
                    "transaction_date",
                    models.DateField(
                        blank=True, help_text="Actual transaction date", null=True
                    ),
                ),
                (
                    "actual_amount",
                    models.DecimalField(
                        decimal_places=2, default=Decimal("0.00"), max_digits=15
                    ),
                ),
                (
                    "budgeted_amount",
                    models.DecimalField(
                        blank=True,
                        decimal_places=2,
                        help_text="Corresponding budget amount for variance",
                        max_digits=15,
                        null=True,
                    ),
                ),
                (
                    "variance_amount",
                    models.DecimalField(
                        blank=True,
                        decimal_places=2,
                        help_text="Actual - Budget",
                        max_digits=15,
                        null=True,
                    ),
                ),
                (
                    "variance_pct",
                    models.DecimalField(
                        blank=True,
                        decimal_places=2,
                        help_text="(Actual - Budget) / Budget * 100",
                        max_digits=10,
                        null=True,
                    ),
                ),
                ("notes", models.TextField(blank=True, null=True)),
                ("attributes", models.JSONField(blank=True, default=dict)),
                ("is_active", models.BooleanField(default=True)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                ("created_by", models.CharField(blank=True, max_length=100, null=True)),
                ("updated_by", models.CharField(blank=True, max_length=100, null=True)),
            ],
            options={
                "db_table": "core_fin_fact_actual",
                "ordering": [
                    "fiscal_year",
                    "fiscal_period",
                    "transaction_date",
                    "category",
                ],
                "managed": False,
            },
        ),
        migrations.CreateModel(
            name="AIAdjustmentSuggestion",
            fields=[
                (
                    "ai_suggestion_id",
                    models.AutoField(primary_key=True, serialize=False),
                ),
                ("adjustment_type", models.CharField(max_length=50)),
                (
                    "suggested_pct",
                    models.DecimalField(
                        blank=True, decimal_places=4, max_digits=7, null=True
                    ),
                ),
                (
                    "confidence_level",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("high", "High Confidence"),
                            ("medium", "Medium Confidence"),
                            ("low", "Low Confidence"),
                            ("none", "Insufficient Data"),
                        ],
                        max_length=20,
                        null=True,
                    ),
                ),
                ("justification", models.TextField(blank=True, null=True)),
                (
                    "model_version",
                    models.CharField(blank=True, max_length=50, null=True),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
            ],
            options={
                "verbose_name": "AI Adjustment Suggestion",
                "verbose_name_plural": "AI Adjustment Suggestions",
                "db_table": "tbl_ai_adjustment_suggestions",
                "ordering": ["comparable", "adjustment_type"],
                "managed": False,
            },
        ),
        migrations.CreateModel(
            name="BenchmarkAISuggestion",
            fields=[
                (
                    "suggestion_id",
                    models.BigAutoField(primary_key=True, serialize=False),
                ),
                ("user_id", models.TextField()),
                ("document_id", models.BigIntegerField()),
                ("project_id", models.BigIntegerField(blank=True, null=True)),
                ("extraction_date", models.DateTimeField(auto_now_add=True)),
                ("category", models.CharField(max_length=50)),
                (
                    "subcategory",
                    models.CharField(blank=True, max_length=100, null=True),
                ),
                ("suggested_name", models.CharField(max_length=200)),
                (
                    "suggested_value",
                    models.DecimalField(decimal_places=4, max_digits=12),
                ),
                (
                    "suggested_uom",
                    models.CharField(blank=True, max_length=20, null=True),
                ),
                (
                    "market_geography",
                    models.CharField(blank=True, max_length=100, null=True),
                ),
                (
                    "property_type",
                    models.CharField(blank=True, max_length=50, null=True),
                ),
                (
                    "confidence_score",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=3, null=True
                    ),
                ),
                ("extraction_context", models.JSONField(blank=True, null=True)),
                (
                    "existing_benchmark_id",
                    models.BigIntegerField(blank=True, null=True),
                ),
                (
                    "variance_percentage",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=6, null=True
                    ),
                ),
                (
                    "inflation_adjusted_comparison",
                    models.JSONField(blank=True, null=True),
                ),
                ("status", models.CharField(default="pending", max_length=20)),
                ("user_response", models.JSONField(blank=True, null=True)),
                ("reviewed_at", models.DateTimeField(blank=True, null=True)),
                ("reviewed_by", models.TextField(blank=True, null=True)),
                ("created_benchmark_id", models.BigIntegerField(blank=True, null=True)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
            ],
            options={
                "verbose_name": "AI Benchmark Suggestion",
                "verbose_name_plural": "AI Benchmark Suggestions",
                "db_table": "tbl_benchmark_ai_suggestions",
                "ordering": ["-extraction_date"],
                "managed": False,
            },
        ),
        migrations.CreateModel(
            name="BenchmarkTransactionCost",
            fields=[
                (
                    "transaction_cost_id",
                    models.BigAutoField(primary_key=True, serialize=False),
                ),
                ("cost_type", models.CharField(max_length=50)),
                ("value", models.DecimalField(decimal_places=4, max_digits=8)),
                ("value_type", models.CharField(max_length=20)),
                ("basis", models.CharField(blank=True, max_length=50, null=True)),
                (
                    "deal_size_min",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=12, null=True
                    ),
                ),
                (
                    "deal_size_max",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=12, null=True
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
            ],
            options={
                "verbose_name": "Transaction Cost Benchmark",
                "verbose_name_plural": "Transaction Cost Benchmarks",
                "db_table": "tbl_benchmark_transaction_cost",
                "ordering": ["cost_type"],
                "managed": False,
            },
        ),
        migrations.CreateModel(
            name="BenchmarkUnitCost",
            fields=[
                (
                    "unit_cost_id",
                    models.BigAutoField(primary_key=True, serialize=False),
                ),
                ("value", models.DecimalField(decimal_places=2, max_digits=12)),
                ("uom_code", models.CharField(max_length=20)),
                (
                    "uom_alt_code",
                    models.CharField(blank=True, max_length=20, null=True),
                ),
                (
                    "low_value",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=12, null=True
                    ),
                ),
                (
                    "high_value",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=12, null=True
                    ),
                ),
                ("cost_phase", models.CharField(blank=True, max_length=50, null=True)),
                ("work_type", models.CharField(blank=True, max_length=100, null=True)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
            ],
            options={
                "verbose_name": "Unit Cost Benchmark",
                "verbose_name_plural": "Unit Cost Benchmarks",
                "db_table": "tbl_benchmark_unit_cost",
                "ordering": ["cost_phase", "work_type"],
                "managed": False,
            },
        ),
        migrations.CreateModel(
            name="BudgetCategory",
            fields=[
                ("category_id", models.BigAutoField(primary_key=True, serialize=False)),
                (
                    "level",
                    models.SmallIntegerField(
                        choices=[
                            (1, "Level 1"),
                            (2, "Level 2"),
                            (3, "Level 3"),
                            (4, "Level 4"),
                        ],
                        help_text="Hierarchy level: 1 (top), 2, 3, 4 (bottom)",
                    ),
                ),
                (
                    "code",
                    models.CharField(
                        help_text="Unique code (e.g., LAND_ACQ, MF_REV_RENT)",
                        max_length=50,
                    ),
                ),
                ("name", models.CharField(help_text="Display name", max_length=200)),
                (
                    "description",
                    models.TextField(
                        blank=True,
                        help_text="Detailed description or usage notes",
                        null=True,
                    ),
                ),
                (
                    "is_template",
                    models.BooleanField(
                        default=False,
                        help_text="True for global templates, False for project-specific",
                    ),
                ),
                (
                    "template_name",
                    models.CharField(
                        blank=True,
                        help_text='Template name (e.g., "Land Development", "Multifamily")',
                        max_length=100,
                        null=True,
                    ),
                ),
                (
                    "project_type_code",
                    models.CharField(
                        blank=True,
                        help_text="Project type code (LAND, MF, RET, OFF, etc.)",
                        max_length=20,
                        null=True,
                    ),
                ),
                (
                    "sort_order",
                    models.IntegerField(
                        default=0, help_text="Display order within same parent"
                    ),
                ),
                (
                    "icon",
                    models.CharField(
                        blank=True,
                        help_text="Icon class name (optional)",
                        max_length=50,
                        null=True,
                    ),
                ),
                (
                    "color",
                    models.CharField(
                        blank=True,
                        help_text="Display color (hex or CSS color name)",
                        max_length=20,
                        null=True,
                    ),
                ),
                (
                    "is_incomplete",
                    models.BooleanField(
                        default=False,
                        help_text="True if created via quick-add and missing optional fields",
                    ),
                ),
                (
                    "created_from",
                    models.CharField(
                        blank=True,
                        help_text="Source: budget_quick_add, admin_panel, ai_import, template, seed_data",
                        max_length=50,
                        null=True,
                    ),
                ),
                (
                    "reminder_dismissed_at",
                    models.DateTimeField(
                        blank=True,
                        help_text="When user dismissed reminder (7-day cooldown)",
                        null=True,
                    ),
                ),
                (
                    "last_reminded_at",
                    models.DateTimeField(
                        blank=True,
                        help_text="Last time Landscaper showed a reminder",
                        null=True,
                    ),
                ),
                (
                    "is_active",
                    models.BooleanField(
                        default=True, help_text="Active/archived status"
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                ("created_by", models.CharField(blank=True, max_length=100, null=True)),
            ],
            options={
                "verbose_name": "Budget Category",
                "verbose_name_plural": "Budget Categories",
                "db_table": "core_budget_category",
                "ordering": ["sort_order", "name"],
                "managed": False,
            },
        ),
        migrations.CreateModel(
            name="BudgetItem",
            fields=[
                (
                    "budget_item_id",
                    models.AutoField(
                        db_column="fact_id", primary_key=True, serialize=False
                    ),
                ),
                (
                    "category",
                    models.CharField(
                        help_text="Category: Revenue, OpEx, CapEx, Financing, etc.",
                        max_length=50,
                    ),
                ),
                (
                    "subcategory",
                    models.CharField(
                        blank=True,
                        help_text="Subcategory: Rent, Payroll, Land, Debt Service, etc.",
                        max_length=100,
                        null=True,
                    ),
                ),
                (
                    "line_item_name",
                    models.CharField(
                        help_text="Display name for budget line", max_length=200
                    ),
                ),
                (
                    "account_code",
                    models.CharField(
                        blank=True,
                        help_text="GL account code",
                        max_length=50,
                        null=True,
                    ),
                ),
                (
                    "fiscal_year",
                    models.IntegerField(help_text="Fiscal year (e.g., 2025)"),
                ),
                (
                    "fiscal_period",
                    models.SmallIntegerField(
                        blank=True,
                        help_text="Period 1-12 for monthly, null for annual",
                        null=True,
                    ),
                ),
                (
                    "period_type",
                    models.CharField(
                        choices=[
                            ("monthly", "Monthly"),
                            ("quarterly", "Quarterly"),
                            ("annual", "Annual"),
                        ],
                        default="annual",
                        max_length=20,
                    ),
                ),
                (
                    "start_period",
                    models.IntegerField(
                        blank=True,
                        db_column="start_period",
                        help_text="Starting period number (1, 2, 3, etc.)",
                        null=True,
                    ),
                ),
                (
                    "periods_to_complete",
                    models.IntegerField(
                        blank=True,
                        db_column="periods_to_complete",
                        help_text="Duration in number of periods",
                        null=True,
                    ),
                ),
                (
                    "end_period",
                    models.IntegerField(
                        blank=True,
                        db_column="end_period",
                        help_text="Ending period number (auto-calculated: start + periods - 1)",
                        null=True,
                    ),
                ),
                (
                    "qty",
                    models.DecimalField(
                        blank=True,
                        db_column="qty",
                        decimal_places=6,
                        default=Decimal("1.0"),
                        help_text="Quantity",
                        max_digits=18,
                        null=True,
                    ),
                ),
                (
                    "rate",
                    models.DecimalField(
                        blank=True,
                        db_column="rate",
                        decimal_places=6,
                        help_text="Rate per unit",
                        max_digits=18,
                        null=True,
                    ),
                ),
                (
                    "uom_code",
                    models.CharField(
                        db_column="uom_code",
                        help_text="Unit of measure (EA, AC, SF, etc.)",
                        max_length=10,
                    ),
                ),
                (
                    "budgeted_amount",
                    models.DecimalField(
                        db_column="amount",
                        decimal_places=2,
                        default=Decimal("0.00"),
                        help_text="Budgeted amount for period (qty Ã— rate)",
                        max_digits=15,
                    ),
                ),
                (
                    "variance_amount",
                    models.DecimalField(
                        blank=True,
                        decimal_places=2,
                        help_text="Variance vs actual (if available)",
                        max_digits=15,
                        null=True,
                    ),
                ),
                (
                    "vendor_name",
                    models.CharField(
                        blank=True,
                        db_column="vendor_name",
                        help_text="Vendor or source for this line item",
                        max_length=200,
                        null=True,
                    ),
                ),
                (
                    "vendor_contact_id",
                    models.IntegerField(
                        blank=True,
                        db_column="vendor_contact_id",
                        help_text="Foreign key to contacts table",
                        null=True,
                    ),
                ),
                (
                    "escalation_rate",
                    models.DecimalField(
                        blank=True,
                        db_column="escalation_rate",
                        decimal_places=2,
                        help_text="Annual escalation rate (%)",
                        max_digits=5,
                        null=True,
                    ),
                ),
                (
                    "escalation_method",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("to_start", "To Start"),
                            ("through_duration", "Through Duration"),
                        ],
                        db_column="escalation_method",
                        help_text="How escalation compounds",
                        max_length=20,
                        null=True,
                    ),
                ),
                (
                    "start_date",
                    models.DateField(
                        blank=True,
                        db_column="start_date",
                        help_text="Budget item start date",
                        null=True,
                    ),
                ),
                (
                    "end_date",
                    models.DateField(
                        blank=True,
                        db_column="end_date",
                        help_text="Budget item end date",
                        null=True,
                    ),
                ),
                (
                    "timing_method",
                    models.CharField(
                        blank=True,
                        choices=[("even", "Even"), ("curve", "S-Curve")],
                        db_column="timing_method",
                        help_text="How costs allocate over time",
                        max_length=20,
                        null=True,
                    ),
                ),
                (
                    "curve_profile",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("standard", "Standard"),
                            ("front_loaded", "Front Loaded"),
                            ("back_loaded", "Back Loaded"),
                        ],
                        db_column="curve_profile",
                        help_text="S-curve shape",
                        max_length=20,
                        null=True,
                    ),
                ),
                (
                    "curve_steepness",
                    models.DecimalField(
                        blank=True,
                        db_column="curve_steepness",
                        decimal_places=2,
                        help_text="Curve steepness 0-100",
                        max_digits=5,
                        null=True,
                    ),
                ),
                (
                    "curve_id",
                    models.BigIntegerField(
                        blank=True,
                        db_column="curve_id",
                        help_text="Reference to custom curve profile",
                        null=True,
                    ),
                ),
                (
                    "contingency_pct",
                    models.DecimalField(
                        blank=True,
                        db_column="contingency_pct",
                        decimal_places=2,
                        help_text="Contingency percentage",
                        max_digits=5,
                        null=True,
                    ),
                ),
                (
                    "confidence_level",
                    models.CharField(
                        blank=True,
                        db_column="confidence_level",
                        help_text="Confidence level (high/medium/low)",
                        max_length=20,
                        null=True,
                    ),
                ),
                (
                    "contract_number",
                    models.CharField(
                        blank=True,
                        db_column="contract_number",
                        help_text="Contract reference number",
                        max_length=100,
                        null=True,
                    ),
                ),
                (
                    "purchase_order",
                    models.CharField(
                        blank=True,
                        db_column="purchase_order",
                        help_text="Purchase order number",
                        max_length=100,
                        null=True,
                    ),
                ),
                (
                    "is_committed",
                    models.BooleanField(
                        db_column="is_committed",
                        default=False,
                        help_text="True if costs are committed",
                    ),
                ),
                (
                    "scope_override",
                    models.CharField(
                        blank=True,
                        db_column="scope_override",
                        help_text="Force budget item into different scope/container",
                        max_length=100,
                        null=True,
                    ),
                ),
                (
                    "activity",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("Acquisition", "Acquisition"),
                            ("Planning & Engineering", "Planning & Engineering"),
                            ("Development", "Development"),
                            ("Operations", "Operations"),
                            ("Disposition", "Disposition"),
                            ("Financing", "Financing"),
                        ],
                        db_column="activity",
                        help_text="Cost lifecycle activity (Acquisition, Planning & Engineering, Development, Operations, Disposition, Financing)",
                        max_length=50,
                        null=True,
                    ),
                ),
                (
                    "cost_type",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("direct", "Direct"),
                            ("indirect", "Indirect"),
                            ("soft", "Soft"),
                            ("financing", "Financing"),
                        ],
                        db_column="cost_type",
                        help_text="Cost classification",
                        max_length=20,
                        null=True,
                    ),
                ),
                (
                    "tax_treatment",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("capitalizable", "Capitalizable"),
                            ("deductible", "Deductible"),
                            ("non_deductible", "Non-Deductible"),
                        ],
                        db_column="tax_treatment",
                        help_text="Tax accounting treatment",
                        max_length=20,
                        null=True,
                    ),
                ),
                (
                    "internal_memo",
                    models.TextField(
                        blank=True,
                        db_column="internal_memo",
                        help_text="Internal notes not included in exports",
                        null=True,
                    ),
                ),
                (
                    "baseline_start_date",
                    models.DateField(
                        blank=True,
                        db_column="baseline_start_date",
                        help_text="Baseline start date from CPM",
                        null=True,
                    ),
                ),
                (
                    "baseline_end_date",
                    models.DateField(
                        blank=True,
                        db_column="baseline_end_date",
                        help_text="Baseline end date from CPM",
                        null=True,
                    ),
                ),
                (
                    "actual_start_date",
                    models.DateField(
                        blank=True,
                        db_column="actual_start_date",
                        help_text="Actual start date",
                        null=True,
                    ),
                ),
                (
                    "actual_end_date",
                    models.DateField(
                        blank=True,
                        db_column="actual_end_date",
                        help_text="Actual end date",
                        null=True,
                    ),
                ),
                (
                    "percent_complete",
                    models.DecimalField(
                        blank=True,
                        db_column="percent_complete",
                        decimal_places=2,
                        help_text="Progress tracking 0-100%",
                        max_digits=5,
                        null=True,
                    ),
                ),
                (
                    "status",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("not_started", "Not Started"),
                            ("in_progress", "In Progress"),
                            ("completed", "Completed"),
                            ("cancelled", "Cancelled"),
                        ],
                        db_column="status",
                        help_text="Work status",
                        max_length=20,
                        null=True,
                    ),
                ),
                (
                    "is_critical",
                    models.BooleanField(
                        db_column="is_critical",
                        default=False,
                        help_text="True if on critical path (CPM computed)",
                    ),
                ),
                (
                    "float_days",
                    models.IntegerField(
                        blank=True,
                        db_column="float_days",
                        help_text="Schedule slack in days (CPM computed)",
                        null=True,
                    ),
                ),
                (
                    "early_start_date",
                    models.DateField(
                        blank=True,
                        db_column="early_start_date",
                        help_text="Early start from CPM",
                        null=True,
                    ),
                ),
                (
                    "late_finish_date",
                    models.DateField(
                        blank=True,
                        db_column="late_finish_date",
                        help_text="Late finish from CPM",
                        null=True,
                    ),
                ),
                (
                    "milestone_id",
                    models.BigIntegerField(
                        blank=True,
                        db_column="milestone_id",
                        help_text="Associated milestone",
                        null=True,
                    ),
                ),
                (
                    "budget_version",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("original", "Original"),
                            ("revised", "Revised"),
                            ("forecast", "Forecast"),
                        ],
                        db_column="budget_version",
                        help_text="Version type",
                        max_length=20,
                        null=True,
                    ),
                ),
                (
                    "version_as_of_date",
                    models.DateField(
                        blank=True,
                        db_column="version_as_of_date",
                        help_text="Version snapshot date",
                        null=True,
                    ),
                ),
                (
                    "funding_id",
                    models.BigIntegerField(
                        blank=True,
                        db_column="funding_id",
                        help_text="Funding source reference",
                        null=True,
                    ),
                ),
                (
                    "funding_draw_pct",
                    models.DecimalField(
                        blank=True,
                        db_column="funding_draw_pct",
                        decimal_places=2,
                        help_text="Percentage drawn from this funding source (0-100)",
                        max_digits=5,
                        null=True,
                    ),
                ),
                (
                    "draw_schedule",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("as_incurred", "As Incurred"),
                            ("monthly", "Monthly"),
                            ("milestone", "Milestone"),
                        ],
                        db_column="draw_schedule",
                        help_text="Draw schedule type",
                        max_length=20,
                        null=True,
                    ),
                ),
                (
                    "retention_pct",
                    models.DecimalField(
                        blank=True,
                        db_column="retention_pct",
                        decimal_places=2,
                        help_text="Holdback percentage (0-100)",
                        max_digits=5,
                        null=True,
                    ),
                ),
                (
                    "payment_terms",
                    models.CharField(
                        blank=True,
                        db_column="payment_terms",
                        help_text="Payment terms",
                        max_length=50,
                        null=True,
                    ),
                ),
                (
                    "invoice_frequency",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("monthly", "Monthly"),
                            ("milestone", "Milestone"),
                            ("completion", "Completion"),
                        ],
                        db_column="invoice_frequency",
                        help_text="Invoice frequency",
                        max_length=20,
                        null=True,
                    ),
                ),
                (
                    "cost_allocation",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("direct", "Direct"),
                            ("shared", "Shared"),
                            ("pro_rata", "Pro-Rata"),
                        ],
                        db_column="cost_allocation",
                        help_text="Cost allocation method",
                        max_length=20,
                        null=True,
                    ),
                ),
                (
                    "is_reimbursable",
                    models.BooleanField(
                        db_column="is_reimbursable",
                        default=False,
                        help_text="True if reimbursable",
                    ),
                ),
                (
                    "allocation_method",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("even", "Even"),
                            ("curve", "Curve"),
                            ("custom", "Custom"),
                        ],
                        db_column="allocation_method",
                        help_text="How costs allocate across periods",
                        max_length=20,
                        null=True,
                    ),
                ),
                (
                    "cf_start_flag",
                    models.BooleanField(
                        db_column="cf_start_flag",
                        default=False,
                        help_text="Marks cash flow beginning",
                    ),
                ),
                (
                    "cf_distribution",
                    models.CharField(
                        blank=True,
                        db_column="cf_distribution",
                        help_text="Cash flow distribution pattern",
                        max_length=100,
                        null=True,
                    ),
                ),
                (
                    "allocated_total",
                    models.DecimalField(
                        blank=True,
                        db_column="allocated_total",
                        decimal_places=2,
                        help_text="Sum of all period allocations",
                        max_digits=18,
                        null=True,
                    ),
                ),
                (
                    "allocation_variance",
                    models.DecimalField(
                        blank=True,
                        db_column="allocation_variance",
                        decimal_places=2,
                        help_text="allocated_total - amount (should be 0)",
                        max_digits=18,
                        null=True,
                    ),
                ),
                (
                    "bid_date",
                    models.DateField(
                        blank=True,
                        db_column="bid_date",
                        help_text="Bid submission date",
                        null=True,
                    ),
                ),
                (
                    "bid_amount",
                    models.DecimalField(
                        blank=True,
                        db_column="bid_amount",
                        decimal_places=2,
                        help_text="Original bid amount",
                        max_digits=18,
                        null=True,
                    ),
                ),
                (
                    "bid_variance",
                    models.DecimalField(
                        blank=True,
                        db_column="bid_variance",
                        decimal_places=2,
                        help_text="amount - bid_amount",
                        max_digits=18,
                        null=True,
                    ),
                ),
                (
                    "change_order_count",
                    models.IntegerField(
                        db_column="change_order_count",
                        default=0,
                        help_text="Number of change orders",
                    ),
                ),
                (
                    "change_order_total",
                    models.DecimalField(
                        db_column="change_order_total",
                        decimal_places=2,
                        default=Decimal("0.00"),
                        help_text="Total change order amount",
                        max_digits=18,
                    ),
                ),
                (
                    "approval_status",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("pending", "Pending"),
                            ("approved", "Approved"),
                            ("rejected", "Rejected"),
                        ],
                        db_column="approval_status",
                        help_text="Approval workflow status",
                        max_length=20,
                        null=True,
                    ),
                ),
                (
                    "approved_by",
                    models.BigIntegerField(
                        blank=True,
                        db_column="approved_by",
                        help_text="User who approved",
                        null=True,
                    ),
                ),
                (
                    "approval_date",
                    models.DateField(
                        blank=True,
                        db_column="approval_date",
                        help_text="Approval date",
                        null=True,
                    ),
                ),
                (
                    "document_count",
                    models.IntegerField(
                        db_column="document_count",
                        default=0,
                        help_text="Number of attached documents",
                    ),
                ),
                (
                    "last_modified_by",
                    models.BigIntegerField(
                        blank=True,
                        db_column="last_modified_by",
                        help_text="User who last modified",
                        null=True,
                    ),
                ),
                (
                    "last_modified_date",
                    models.DateTimeField(
                        blank=True,
                        db_column="last_modified_date",
                        help_text="Last modification timestamp",
                        null=True,
                    ),
                ),
                (
                    "is_rollup",
                    models.BooleanField(
                        default=False,
                        help_text="True if this is an aggregated/calculated value",
                    ),
                ),
                ("notes", models.TextField(blank=True, null=True)),
                (
                    "attributes",
                    models.JSONField(
                        blank=True,
                        default=dict,
                        help_text="Flexible attributes (assumptions, drivers, etc.)",
                    ),
                ),
                ("is_active", models.BooleanField(default=True)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                ("created_by", models.CharField(blank=True, max_length=100, null=True)),
                ("updated_by", models.CharField(blank=True, max_length=100, null=True)),
            ],
            options={
                "db_table": "core_fin_fact_budget",
                "ordering": [
                    "fiscal_year",
                    "fiscal_period",
                    "category",
                    "line_item_name",
                ],
                "managed": False,
            },
        ),
        migrations.CreateModel(
            name="CapRateComp",
            fields=[
                (
                    "cap_rate_comp_id",
                    models.AutoField(primary_key=True, serialize=False),
                ),
                (
                    "property_address",
                    models.CharField(blank=True, max_length=255, null=True),
                ),
                (
                    "sale_price",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=15, null=True
                    ),
                ),
                (
                    "noi",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=12, null=True
                    ),
                ),
                (
                    "implied_cap_rate",
                    models.DecimalField(
                        blank=True, decimal_places=4, max_digits=5, null=True
                    ),
                ),
                ("sale_date", models.DateField(blank=True, null=True)),
                ("notes", models.TextField(blank=True, null=True)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
            ],
            options={
                "verbose_name": "Cap Rate Comparable",
                "verbose_name_plural": "Cap Rate Comparables",
                "db_table": "tbl_cap_rate_comps",
                "ordering": ["income_approach", "sale_date"],
                "managed": False,
            },
        ),
        migrations.CreateModel(
            name="CategoryActivity",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                ("category_id", models.IntegerField()),
                (
                    "activity",
                    models.CharField(
                        choices=[
                            ("Acquisition", "Acquisition"),
                            ("Planning & Engineering", "Planning & Engineering"),
                            ("Development", "Development"),
                            ("Operations", "Operations"),
                            ("Disposition", "Disposition"),
                            ("Financing", "Financing"),
                        ],
                        db_column="activity",
                        max_length=50,
                    ),
                ),
                ("sort_order", models.IntegerField(default=0)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
            ],
            options={
                "verbose_name": "Category Activity",
                "verbose_name_plural": "Category Activities",
                "db_table": "core_category_lifecycle_stages",
                "ordering": ["activity", "sort_order"],
                "managed": False,
            },
        ),
        migrations.CreateModel(
            name="CategoryCompletionStatus",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "missing_field",
                    models.CharField(
                        choices=[
                            ("description", "Description"),
                            ("icon", "Icon"),
                            ("color", "Color"),
                            ("parent", "Parent Category"),
                        ],
                        help_text="Field that needs to be completed",
                        max_length=50,
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
            ],
            options={
                "verbose_name": "Category Completion Status",
                "verbose_name_plural": "Category Completion Statuses",
                "db_table": "core_category_completion_status",
                "ordering": ["created_at"],
                "managed": False,
            },
        ),
        migrations.CreateModel(
            name="CategoryTagLibrary",
            fields=[
                ("tag_id", models.AutoField(primary_key=True, serialize=False)),
                ("tag_name", models.CharField(max_length=50, unique=True)),
                ("tag_context", models.CharField(max_length=50)),
                ("is_system_default", models.BooleanField(default=True)),
                ("description", models.TextField(blank=True, null=True)),
                ("display_order", models.IntegerField(default=999)),
                ("is_active", models.BooleanField(default=True)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
            ],
            options={
                "verbose_name": "Category Tag",
                "verbose_name_plural": "Category Tags",
                "db_table": "core_category_tag_library",
                "ordering": ["display_order", "tag_name"],
                "managed": False,
            },
        ),
        migrations.CreateModel(
            name="CostAllocation",
            fields=[
                ("allocation_id", models.AutoField(primary_key=True, serialize=False)),
                (
                    "allocation_percentage",
                    models.DecimalField(
                        decimal_places=3,
                        help_text="Percentage of total budget (0.000 to 100.000)",
                        max_digits=6,
                    ),
                ),
                (
                    "allocation_basis",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("area", "By Area"),
                            ("units", "By Units"),
                            ("custom", "Custom"),
                            ("equal", "Equal"),
                        ],
                        max_length=50,
                        null=True,
                    ),
                ),
                (
                    "allocated_budget_amount",
                    models.DecimalField(
                        blank=True,
                        decimal_places=2,
                        help_text="Calculated: total_budget Ã— (allocation_percentage / 100)",
                        max_digits=15,
                        null=True,
                    ),
                ),
                (
                    "spent_to_date",
                    models.DecimalField(
                        decimal_places=2, default=Decimal("0.00"), max_digits=15
                    ),
                ),
                (
                    "cost_to_complete",
                    models.DecimalField(
                        blank=True,
                        decimal_places=2,
                        help_text="Remaining budget allocated to this container",
                        max_digits=15,
                        null=True,
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
            ],
            options={
                "db_table": "tbl_cost_allocation",
                "ordering": ["finance_structure", "container"],
                "managed": False,
            },
        ),
        migrations.CreateModel(
            name="CostApproach",
            fields=[
                (
                    "cost_approach_id",
                    models.AutoField(primary_key=True, serialize=False),
                ),
                (
                    "land_valuation_method",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("sales_comparison", "Sales Comparison"),
                            ("allocation", "Allocation"),
                            ("extraction", "Extraction"),
                            ("other", "Other"),
                        ],
                        max_length=50,
                        null=True,
                    ),
                ),
                (
                    "land_area_sf",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=12, null=True
                    ),
                ),
                (
                    "land_value_per_sf",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=10, null=True
                    ),
                ),
                (
                    "total_land_value",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=15, null=True
                    ),
                ),
                (
                    "cost_method",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("comparative_unit", "Comparative Unit"),
                            ("unit_in_place", "Unit-in-Place"),
                            ("quantity_survey", "Quantity Survey"),
                            ("marshall_swift", "Marshall & Swift"),
                            ("other", "Other"),
                        ],
                        max_length=50,
                        null=True,
                    ),
                ),
                (
                    "building_area_sf",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=12, null=True
                    ),
                ),
                (
                    "cost_per_sf",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=10, null=True
                    ),
                ),
                (
                    "base_replacement_cost",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=15, null=True
                    ),
                ),
                (
                    "entrepreneurial_incentive_pct",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=5, null=True
                    ),
                ),
                (
                    "total_replacement_cost",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=15, null=True
                    ),
                ),
                (
                    "physical_curable",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=12, null=True
                    ),
                ),
                (
                    "physical_incurable_short",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=12, null=True
                    ),
                ),
                (
                    "physical_incurable_long",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=12, null=True
                    ),
                ),
                (
                    "functional_curable",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=12, null=True
                    ),
                ),
                (
                    "functional_incurable",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=12, null=True
                    ),
                ),
                (
                    "external_obsolescence",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=12, null=True
                    ),
                ),
                (
                    "total_depreciation",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=15, null=True
                    ),
                ),
                (
                    "depreciated_improvements",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=15, null=True
                    ),
                ),
                (
                    "site_improvements_cost",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=12, null=True
                    ),
                ),
                (
                    "site_improvements_description",
                    models.TextField(blank=True, null=True),
                ),
                (
                    "indicated_value",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=15, null=True
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
            ],
            options={
                "verbose_name": "Cost Approach",
                "verbose_name_plural": "Cost Approaches",
                "db_table": "tbl_cost_approach",
                "managed": False,
            },
        ),
        migrations.CreateModel(
            name="FinanceStructure",
            fields=[
                (
                    "finance_structure_id",
                    models.AutoField(primary_key=True, serialize=False),
                ),
                (
                    "structure_code",
                    models.CharField(
                        help_text="Unique code within project (e.g., OFFSITE-PH1)",
                        max_length=50,
                    ),
                ),
                (
                    "structure_name",
                    models.CharField(
                        help_text='Display name (e.g., "Offsite Infrastructure Phase 1")',
                        max_length=200,
                    ),
                ),
                ("description", models.TextField(blank=True, null=True)),
                (
                    "structure_type",
                    models.CharField(
                        choices=[
                            ("capital_cost_pool", "Capital Cost Pool"),
                            ("operating_obligation_pool", "Operating Obligation Pool"),
                        ],
                        help_text="Capital (one-time) or Operating (recurring)",
                        max_length=50,
                    ),
                ),
                (
                    "total_budget_amount",
                    models.DecimalField(
                        blank=True,
                        decimal_places=2,
                        help_text="Total budget for one-time capital costs",
                        max_digits=15,
                        null=True,
                    ),
                ),
                (
                    "budget_category",
                    models.CharField(
                        blank=True,
                        help_text="Maps to budget category (Revenue, OpEx, CapEx, etc.)",
                        max_length=100,
                        null=True,
                    ),
                ),
                (
                    "is_recurring",
                    models.BooleanField(
                        default=False,
                        help_text="True for recurring obligations like ground leases",
                    ),
                ),
                (
                    "recurrence_frequency",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("annual", "Annual"),
                            ("monthly", "Monthly"),
                            ("quarterly", "Quarterly"),
                        ],
                        max_length=20,
                        null=True,
                    ),
                ),
                (
                    "annual_amount",
                    models.DecimalField(
                        blank=True,
                        decimal_places=2,
                        help_text="Annual amount for recurring obligations",
                        max_digits=12,
                        null=True,
                    ),
                ),
                (
                    "allocation_method",
                    models.CharField(
                        choices=[
                            ("equal", "Equal - Split evenly across containers"),
                            ("by_area", "By Area - Proportional to acres/SF"),
                            ("by_units", "By Units - Proportional to lot/unit count"),
                            (
                                "by_custom_pct",
                                "Custom Percentages - Manually specified",
                            ),
                        ],
                        help_text="How costs are allocated across containers",
                        max_length=50,
                    ),
                ),
                ("is_active", models.BooleanField(default=True)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                ("created_by", models.CharField(blank=True, max_length=100, null=True)),
                ("updated_by", models.CharField(blank=True, max_length=100, null=True)),
            ],
            options={
                "db_table": "tbl_finance_structure",
                "ordering": ["project", "structure_code"],
                "managed": False,
            },
        ),
        migrations.CreateModel(
            name="GlobalBenchmark",
            fields=[
                ("benchmark_id", models.AutoField(primary_key=True, serialize=False)),
                ("benchmark_name", models.CharField(max_length=200)),
                (
                    "benchmark_type",
                    models.CharField(blank=True, max_length=50, null=True),
                ),
                (
                    "market_geography",
                    models.CharField(blank=True, max_length=100, null=True),
                ),
                ("is_active", models.BooleanField(default=True)),
            ],
            options={
                "verbose_name": "Global Benchmark",
                "verbose_name_plural": "Global Benchmarks",
                "db_table": "core_global_benchmark",
                "ordering": ["benchmark_name"],
                "managed": False,
            },
        ),
        migrations.CreateModel(
            name="GlobalBenchmarkRegistry",
            fields=[
                (
                    "benchmark_id",
                    models.BigAutoField(primary_key=True, serialize=False),
                ),
                ("user_id", models.TextField()),
                ("category", models.CharField(max_length=50)),
                (
                    "subcategory",
                    models.CharField(blank=True, max_length=100, null=True),
                ),
                ("benchmark_name", models.CharField(max_length=200)),
                ("description", models.TextField(blank=True, null=True)),
                (
                    "market_geography",
                    models.CharField(blank=True, max_length=100, null=True),
                ),
                (
                    "property_type",
                    models.CharField(blank=True, max_length=50, null=True),
                ),
                ("source_type", models.CharField(max_length=50)),
                ("source_document_id", models.BigIntegerField(blank=True, null=True)),
                ("source_project_id", models.BigIntegerField(blank=True, null=True)),
                ("extraction_date", models.DateField(blank=True, null=True)),
                ("confidence_level", models.CharField(default="medium", max_length=20)),
                ("usage_count", models.IntegerField(default=0)),
                ("as_of_date", models.DateField(auto_now_add=True)),
                (
                    "cpi_index_value",
                    models.DecimalField(
                        blank=True, decimal_places=4, max_digits=10, null=True
                    ),
                ),
                ("context_metadata", models.JSONField(blank=True, null=True)),
                ("is_active", models.BooleanField(default=True)),
                ("is_global", models.BooleanField(default=False)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                ("created_by", models.TextField(blank=True, null=True)),
                ("updated_by", models.TextField(blank=True, null=True)),
            ],
            options={
                "verbose_name": "Global Benchmark",
                "verbose_name_plural": "Global Benchmarks",
                "db_table": "tbl_global_benchmark_registry",
                "ordering": ["-created_at"],
                "managed": False,
            },
        ),
        migrations.CreateModel(
            name="IncomeApproach",
            fields=[
                (
                    "income_approach_id",
                    models.AutoField(primary_key=True, serialize=False),
                ),
                (
                    "market_cap_rate_method",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("comp_sales", "Comparable Sales"),
                            ("band_investment", "Band of Investment"),
                            ("investor_survey", "Investor Survey"),
                            ("other", "Other"),
                        ],
                        max_length=50,
                        null=True,
                    ),
                ),
                (
                    "selected_cap_rate",
                    models.DecimalField(
                        blank=True, decimal_places=4, max_digits=5, null=True
                    ),
                ),
                ("cap_rate_justification", models.TextField(blank=True, null=True)),
                (
                    "direct_cap_value",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=15, null=True
                    ),
                ),
                ("forecast_period_years", models.IntegerField(blank=True, null=True)),
                (
                    "terminal_cap_rate",
                    models.DecimalField(
                        blank=True, decimal_places=4, max_digits=5, null=True
                    ),
                ),
                (
                    "discount_rate",
                    models.DecimalField(
                        blank=True, decimal_places=4, max_digits=5, null=True
                    ),
                ),
                (
                    "dcf_value",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=15, null=True
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
            ],
            options={
                "verbose_name": "Income Approach",
                "verbose_name_plural": "Income Approaches",
                "db_table": "tbl_income_approach",
                "managed": False,
            },
        ),
        migrations.CreateModel(
            name="ItemBenchmarkLink",
            fields=[
                ("link_id", models.AutoField(primary_key=True, serialize=False)),
                ("is_primary", models.BooleanField(default=False)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
            ],
            options={
                "verbose_name": "Item Benchmark Link",
                "verbose_name_plural": "Item Benchmark Links",
                "db_table": "core_item_benchmark_link",
                "managed": False,
            },
        ),
        migrations.CreateModel(
            name="ParticipationPayment",
            fields=[
                ("payment_id", models.AutoField(primary_key=True, serialize=False)),
                ("payment_date", models.DateField()),
                (
                    "payment_period",
                    models.IntegerField(
                        blank=True,
                        help_text="Links to calculation period if applicable",
                        null=True,
                    ),
                ),
                (
                    "homes_closed_count",
                    models.IntegerField(help_text="Number of homes closed this period"),
                ),
                (
                    "gross_home_sales",
                    models.DecimalField(
                        decimal_places=2,
                        help_text="Total home sales revenue this period",
                        max_digits=15,
                    ),
                ),
                (
                    "participation_base",
                    models.DecimalField(
                        blank=True,
                        decimal_places=2,
                        help_text="Amount used for participation calc",
                        max_digits=15,
                        null=True,
                    ),
                ),
                (
                    "participation_amount",
                    models.DecimalField(
                        decimal_places=2,
                        help_text="Gross participation (sales Ã— participation_rate)",
                        max_digits=15,
                    ),
                ),
                (
                    "less_base_allocation",
                    models.DecimalField(
                        decimal_places=2,
                        default=Decimal("0.00"),
                        help_text="Pro-rata portion of original settlement payment",
                        max_digits=15,
                    ),
                ),
                (
                    "net_participation_payment",
                    models.DecimalField(
                        decimal_places=2,
                        help_text="Net payment: participation_amount - less_base_allocation",
                        max_digits=15,
                    ),
                ),
                (
                    "cumulative_homes_closed",
                    models.IntegerField(
                        blank=True, help_text="Total homes closed to date", null=True
                    ),
                ),
                (
                    "cumulative_participation_paid",
                    models.DecimalField(
                        blank=True,
                        decimal_places=2,
                        help_text="Total participation paid to date",
                        max_digits=15,
                        null=True,
                    ),
                ),
                (
                    "payment_status",
                    models.CharField(
                        choices=[
                            ("calculated", "Calculated"),
                            ("paid", "Paid"),
                            ("disputed", "Disputed"),
                        ],
                        default="calculated",
                        max_length=50,
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
            ],
            options={
                "db_table": "tbl_participation_payment",
                "ordering": ["settlement", "-payment_date"],
                "managed": False,
            },
        ),
        migrations.CreateModel(
            name="PlanningStandard",
            fields=[
                ("standard_id", models.AutoField(primary_key=True, serialize=False)),
                ("standard_name", models.CharField(max_length=100)),
                (
                    "default_planning_efficiency",
                    models.DecimalField(decimal_places=4, default=0.75, max_digits=5),
                ),
                (
                    "default_street_row_pct",
                    models.DecimalField(
                        blank=True, decimal_places=4, max_digits=5, null=True
                    ),
                ),
                (
                    "default_park_dedication_pct",
                    models.DecimalField(
                        blank=True, decimal_places=4, max_digits=5, null=True
                    ),
                ),
                ("is_active", models.BooleanField(default=True)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
            ],
            options={
                "verbose_name": "Planning Standard",
                "verbose_name_plural": "Planning Standards",
                "db_table": "core_planning_standards",
                "ordering": ["standard_id"],
                "managed": False,
            },
        ),
        migrations.CreateModel(
            name="SalesCompAdjustment",
            fields=[
                ("adjustment_id", models.AutoField(primary_key=True, serialize=False)),
                (
                    "adjustment_type",
                    models.CharField(
                        choices=[
                            ("property_rights", "Property Rights"),
                            ("financing", "Financing"),
                            ("conditions_of_sale", "Conditions of Sale"),
                            ("market_conditions", "Market Conditions"),
                            ("location", "Location"),
                            ("physical_condition", "Physical Cond"),
                            ("physical_age", "Physical - Age"),
                            ("physical_unit_mix", "Physical - Unit Mix"),
                            ("economic", "Economic"),
                            ("legal", "Legal"),
                            ("other", "Other"),
                        ],
                        max_length=50,
                    ),
                ),
                (
                    "adjustment_pct",
                    models.DecimalField(
                        blank=True, decimal_places=3, max_digits=6, null=True
                    ),
                ),
                (
                    "adjustment_amount",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=12, null=True
                    ),
                ),
                ("justification", models.TextField(blank=True, null=True)),
                (
                    "user_adjustment_pct",
                    models.DecimalField(
                        blank=True,
                        decimal_places=4,
                        help_text="User's final adjustment value (from Final column)",
                        max_digits=7,
                        null=True,
                    ),
                ),
                (
                    "ai_accepted",
                    models.BooleanField(
                        default=False,
                        help_text="TRUE if user accepted AI suggestion via checkbox",
                    ),
                ),
                (
                    "user_notes",
                    models.TextField(
                        blank=True,
                        help_text="User's notes about their adjustment decision",
                        null=True,
                    ),
                ),
                (
                    "last_modified_by",
                    models.CharField(blank=True, max_length=100, null=True),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
            ],
            options={
                "verbose_name": "Sales Comp Adjustment",
                "verbose_name_plural": "Sales Comp Adjustments",
                "db_table": "tbl_sales_comp_adjustments",
                "ordering": ["comparable", "adjustment_type"],
                "managed": False,
            },
        ),
        migrations.CreateModel(
            name="SalesComparable",
            fields=[
                ("comparable_id", models.AutoField(primary_key=True, serialize=False)),
                ("comp_number", models.IntegerField(blank=True, null=True)),
                (
                    "property_name",
                    models.CharField(blank=True, max_length=255, null=True),
                ),
                ("address", models.CharField(blank=True, max_length=255, null=True)),
                ("city", models.CharField(blank=True, max_length=100, null=True)),
                ("state", models.CharField(blank=True, max_length=2, null=True)),
                ("zip", models.CharField(blank=True, max_length=10, null=True)),
                ("sale_date", models.DateField(blank=True, null=True)),
                (
                    "sale_price",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=15, null=True
                    ),
                ),
                (
                    "price_per_unit",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=10, null=True
                    ),
                ),
                (
                    "price_per_sf",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=10, null=True
                    ),
                ),
                ("year_built", models.IntegerField(blank=True, null=True)),
                ("units", models.IntegerField(blank=True, null=True)),
                ("building_sf", models.IntegerField(blank=True, null=True)),
                (
                    "cap_rate",
                    models.DecimalField(
                        blank=True, decimal_places=4, max_digits=5, null=True
                    ),
                ),
                (
                    "grm",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=6, null=True
                    ),
                ),
                (
                    "distance_from_subject",
                    models.CharField(blank=True, max_length=50, null=True),
                ),
                (
                    "latitude",
                    models.DecimalField(
                        blank=True, decimal_places=7, max_digits=10, null=True
                    ),
                ),
                (
                    "longitude",
                    models.DecimalField(
                        blank=True, decimal_places=7, max_digits=10, null=True
                    ),
                ),
                ("unit_mix", models.JSONField(blank=True, null=True)),
                ("notes", models.TextField(blank=True, null=True)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
            ],
            options={
                "verbose_name": "Sales Comparable",
                "verbose_name_plural": "Sales Comparables",
                "db_table": "tbl_sales_comparables",
                "ordering": ["project", "comp_number"],
                "managed": False,
            },
        ),
        migrations.CreateModel(
            name="SaleSettlement",
            fields=[
                ("settlement_id", models.AutoField(primary_key=True, serialize=False)),
                ("sale_date", models.DateField()),
                ("buyer_name", models.CharField(blank=True, max_length=200, null=True)),
                (
                    "buyer_entity",
                    models.CharField(blank=True, max_length=200, null=True),
                ),
                (
                    "list_price",
                    models.DecimalField(
                        decimal_places=2, help_text="Gross sale price", max_digits=15
                    ),
                ),
                (
                    "allocated_cost_to_complete",
                    models.DecimalField(
                        decimal_places=2,
                        default=Decimal("0.00"),
                        help_text="Buyer credit for unspent allocated costs",
                        max_digits=15,
                    ),
                ),
                (
                    "other_adjustments",
                    models.DecimalField(
                        decimal_places=2,
                        default=Decimal("0.00"),
                        help_text="Other adjustments (closing costs, prorations, etc.)",
                        max_digits=15,
                    ),
                ),
                (
                    "net_proceeds",
                    models.DecimalField(
                        decimal_places=2,
                        help_text="list_price - allocated_cost_to_complete - other_adjustments",
                        max_digits=15,
                    ),
                ),
                (
                    "settlement_type",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("cash_sale", "Cash Sale"),
                            ("seller_note", "Seller Note"),
                            ("earnout", "Earnout"),
                            ("participation", "Participation"),
                        ],
                        max_length=50,
                        null=True,
                    ),
                ),
                ("settlement_notes", models.TextField(blank=True, null=True)),
                (
                    "cost_allocation_detail",
                    models.JSONField(
                        blank=True,
                        help_text="Snapshot of cost breakdown at time of sale",
                        null=True,
                    ),
                ),
                (
                    "has_participation",
                    models.BooleanField(
                        default=False,
                        help_text="True if seller retains participation in future home sales",
                    ),
                ),
                (
                    "participation_rate",
                    models.DecimalField(
                        blank=True,
                        decimal_places=3,
                        help_text="Participation percentage (e.g., 25.000 for 25%)",
                        max_digits=6,
                        null=True,
                    ),
                ),
                (
                    "participation_basis",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("gross_home_sales", "Gross Home Sales"),
                            ("net_home_sales", "Net Home Sales"),
                        ],
                        max_length=50,
                        null=True,
                    ),
                ),
                (
                    "participation_minimum",
                    models.DecimalField(
                        blank=True,
                        decimal_places=2,
                        help_text="Floor price below which no participation is paid",
                        max_digits=15,
                        null=True,
                    ),
                ),
                (
                    "participation_target_price",
                    models.DecimalField(
                        blank=True,
                        decimal_places=2,
                        help_text="Target price per unit for participation calculation",
                        max_digits=12,
                        null=True,
                    ),
                ),
                (
                    "settlement_status",
                    models.CharField(
                        choices=[
                            ("pending", "Pending"),
                            ("closed", "Closed"),
                            ("cancelled", "Cancelled"),
                        ],
                        default="pending",
                        max_length=50,
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                ("created_by", models.CharField(blank=True, max_length=100, null=True)),
                ("updated_by", models.CharField(blank=True, max_length=100, null=True)),
            ],
            options={
                "db_table": "tbl_sale_settlement",
                "ordering": ["-sale_date"],
                "managed": False,
            },
        ),
        migrations.CreateModel(
            name="UnitCostCategory",
            fields=[
                ("category_id", models.AutoField(primary_key=True, serialize=False)),
                ("category_name", models.CharField(max_length=255)),
                ("tags", models.JSONField(default=list)),
                ("sort_order", models.IntegerField(default=0)),
                ("is_active", models.BooleanField(default=True)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
            ],
            options={
                "verbose_name": "Unit Cost Category",
                "verbose_name_plural": "Unit Cost Categories",
                "db_table": "core_unit_cost_category",
                "ordering": ["sort_order", "category_name"],
                "managed": False,
            },
        ),
        migrations.CreateModel(
            name="UnitCostItem",
            fields=[
                ("item_id", models.AutoField(primary_key=True, serialize=False)),
                ("item_name", models.CharField(max_length=200)),
                ("default_uom_code", models.CharField(max_length=10)),
                (
                    "quantity",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=12, null=True
                    ),
                ),
                (
                    "typical_mid_value",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=12, null=True
                    ),
                ),
                (
                    "market_geography",
                    models.CharField(blank=True, max_length=100, null=True),
                ),
                ("source", models.CharField(blank=True, max_length=200, null=True)),
                ("as_of_date", models.DateField(blank=True, null=True)),
                ("project_type_code", models.CharField(default="LAND", max_length=50)),
                ("last_used_date", models.DateField(blank=True, null=True)),
                ("usage_count", models.IntegerField(default=0)),
                ("is_active", models.BooleanField(default=True)),
                ("created_from_ai", models.BooleanField(default=False)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
            ],
            options={
                "verbose_name": "Unit Cost Item",
                "verbose_name_plural": "Unit Cost Items",
                "db_table": "core_unit_cost_item",
                "ordering": ["item_name"],
                "managed": False,
            },
        ),
        migrations.CreateModel(
            name="ValuationReconciliation",
            fields=[
                (
                    "reconciliation_id",
                    models.AutoField(primary_key=True, serialize=False),
                ),
                (
                    "sales_comparison_value",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=15, null=True
                    ),
                ),
                (
                    "sales_comparison_weight",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=4, null=True
                    ),
                ),
                (
                    "cost_approach_value",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=15, null=True
                    ),
                ),
                (
                    "cost_approach_weight",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=4, null=True
                    ),
                ),
                (
                    "income_approach_value",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=15, null=True
                    ),
                ),
                (
                    "income_approach_weight",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=4, null=True
                    ),
                ),
                (
                    "final_reconciled_value",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=15, null=True
                    ),
                ),
                ("reconciliation_narrative", models.TextField(blank=True, null=True)),
                ("valuation_date", models.DateField(blank=True, null=True)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
            ],
            options={
                "verbose_name": "Valuation Reconciliation",
                "verbose_name_plural": "Valuation Reconciliations",
                "db_table": "tbl_valuation_reconciliation",
                "managed": False,
            },
        ),
        migrations.CreateModel(
            name="ScenarioComparison",
            fields=[
                ("comparison_id", models.AutoField(primary_key=True, serialize=False)),
                ("comparison_name", models.CharField(max_length=100)),
                (
                    "scenario_ids",
                    django.contrib.postgres.fields.ArrayField(
                        base_field=models.IntegerField(), size=5
                    ),
                ),
                (
                    "comparison_type",
                    models.CharField(
                        choices=[
                            ("side_by_side", "Side by Side"),
                            ("variance_from_base", "Variance from Base"),
                            ("probability_weighted", "Probability Weighted"),
                        ],
                        default="side_by_side",
                        max_length=20,
                    ),
                ),
                (
                    "scenario_probabilities",
                    django.contrib.postgres.fields.ArrayField(
                        base_field=models.DecimalField(decimal_places=2, max_digits=5),
                        blank=True,
                        null=True,
                        size=None,
                    ),
                ),
                ("comparison_results", models.JSONField(blank=True, null=True)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "project",
                    models.ForeignKey(
                        db_column="project_id",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="scenario_comparisons",
                        to="projects.project",
                    ),
                ),
            ],
            options={
                "db_table": "tbl_scenario_comparison",
                "ordering": ["project", "-created_at"],
            },
        ),
        migrations.CreateModel(
            name="Scenario",
            fields=[
                ("scenario_id", models.AutoField(primary_key=True, serialize=False)),
                ("scenario_name", models.CharField(max_length=100)),
                (
                    "scenario_type",
                    models.CharField(
                        choices=[
                            ("base", "Base Case"),
                            ("optimistic", "Optimistic"),
                            ("conservative", "Conservative"),
                            ("stress", "Stress Test"),
                            ("custom", "Custom"),
                        ],
                        default="custom",
                        max_length=20,
                    ),
                ),
                ("scenario_code", models.CharField(max_length=50, unique=True)),
                ("is_active", models.BooleanField(default=False)),
                ("is_locked", models.BooleanField(default=False)),
                ("display_order", models.IntegerField(default=0)),
                ("description", models.TextField(blank=True, null=True)),
                ("color_hex", models.CharField(default="#6B7280", max_length=7)),
                (
                    "variance_method",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("percentage", "Percentage Adjustment"),
                            ("absolute", "Absolute Value Change"),
                            ("mixed", "Mixed Approach"),
                        ],
                        max_length=20,
                        null=True,
                    ),
                ),
                (
                    "revenue_variance_pct",
                    models.DecimalField(
                        blank=True,
                        decimal_places=2,
                        max_digits=5,
                        null=True,
                        validators=[
                            django.core.validators.MinValueValidator(-100),
                            django.core.validators.MaxValueValidator(1000),
                        ],
                    ),
                ),
                (
                    "cost_variance_pct",
                    models.DecimalField(
                        blank=True,
                        decimal_places=2,
                        max_digits=5,
                        null=True,
                        validators=[
                            django.core.validators.MinValueValidator(-100),
                            django.core.validators.MaxValueValidator(1000),
                        ],
                    ),
                ),
                (
                    "absorption_variance_pct",
                    models.DecimalField(
                        blank=True,
                        decimal_places=2,
                        max_digits=5,
                        null=True,
                        validators=[
                            django.core.validators.MinValueValidator(-100),
                            django.core.validators.MaxValueValidator(1000),
                        ],
                    ),
                ),
                ("start_date_offset_months", models.IntegerField(default=0)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "cloned_from",
                    models.ForeignKey(
                        blank=True,
                        db_column="cloned_from_scenario_id",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="clones",
                        to="financial.scenario",
                    ),
                ),
                (
                    "created_by",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="created_scenarios",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "project",
                    models.ForeignKey(
                        db_column="project_id",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="scenarios",
                        to="projects.project",
                    ),
                ),
            ],
            options={
                "db_table": "tbl_scenario",
                "ordering": ["project", "display_order", "scenario_name"],
                "indexes": [
                    models.Index(
                        fields=["project", "is_active"],
                        name="tbl_scenari_project_27d88e_idx",
                    ),
                    models.Index(
                        fields=["project", "display_order"],
                        name="tbl_scenari_project_dd7924_idx",
                    ),
                ],
            },
        ),
    ]
