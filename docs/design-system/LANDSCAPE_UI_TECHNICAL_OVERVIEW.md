# Landscape Application - UI Technical Documentation
November 18, 2025

## Table of Contents
- [1. Navigation Architecture](#1-navigation-architecture)
  - [1.1 Primary Navigation](#11-primary-navigation)
  - [1.2 Project Navigation Layer](#12-project-navigation-layer)
  - [1.3 Ancillary Navigation Surfaces](#13-ancillary-navigation-surfaces)
  - [1.4 Route Structure](#14-route-structure)
  - [1.5 Project Context Switching](#15-project-context-switching)
  - [1.6 Tab Implementations](#16-tab-implementations)
  - [1.7 Header and Breadcrumb Patterns](#17-header-and-breadcrumb-patterns)
- [2. Page Inventory](#2-page-inventory)
- [3. Component Architecture](#3-component-architecture)
- [4. Styling System](#4-styling-system)
- [5. State Management](#5-state-management)
- [6. Key User Flows](#6-key-user-flows)
- [7. Interactive Elements Catalog](#7-interactive-elements-catalog)
- [8. Responsive Behavior](#8-responsive-behavior)
- [9. Performance Considerations](#9-performance-considerations)
- [10. Accessibility](#10-accessibility)
- [Appendix A: File Structure](#appendix-a-file-structure)
- [Appendix B: UI Dependencies](#appendix-b-ui-dependencies)

---

## 1. Navigation Architecture

### 1.1 Primary Navigation
- **Component:** `TopNavigationBar` (`src/app/components/TopNavigationBar.tsx:1`)
- **Pattern:** Sticky horizontal bar at the top of every page rendered through `NavigationLayout`.
- **Structure:**
  - Left: Inverted Landscape logo linking to `/`.
  - Right cluster: Global nav links (`GLOBAL_NAV_LINKS` â†’ Dashboard `/dashboard`, Documents `/dms`), "Landscaper AI" trigger, `SandboxDropdown`, `UserMenuDropdown`, `SettingsDropdown`, theme toggle, bug reporter icon.
  - Uses `usePathname` to highlight the active link, inline hover handlers to emulate pill hover states, and CSS variables defined in `src/styles/tokens.css` for color (58 px tall, `z-index` 50, border bottom `var(--nav-border)`).
- **Interaction notes:**
  - Theme toggle is driven by `CoreUIThemeProvider` context and updates `data-theme` attributes globally.
  - Bug reporter button integrates with `IssueReporter` context to provide contextual hints when no element has been targeted.
  - Drop-down components rely on the shared `useOutsideClick` hook to close on blur.
- **Responsive behavior:** Flex container with wrapping disabled; on narrow screens the items compress horizontally (no hamburger yet) â†’ the "clumsy" behavior stems from scroll overflow once width < ~1100px.

```
+---------------------------------------------------------------------+
| LOGO | Dashboard | Documents | AI | Sandbox â–¾ | User â–¾ | Settings â–¾ |
|                                                    Theme | Bug ðŸž    |
+---------------------------------------------------------------------+
```

### 1.2 Project Navigation Layer
- **Component:** `ProjectContextBar` (`src/app/components/ProjectContextBar.tsx:1`).
- **Scope:** Automatically injected for all `/projects/[projectId]` routes via `projects/[projectId]/layout.tsx:1` under the global navigation.
- **Layout:** Sticky bar positioned at `top: 58px`, height 56 px, `z-index` 40.
  - Left: `<select>` bound to `useProjectContext`; selecting pushes `/projects/{id}` and persists via `ProjectProvider`.
  - Right: horizontal tab buttons generated by `getTabsForPropertyType` with optional `ModeChip` (Napkin/Standard/Detail) badges per tab. Hover states lighten background, active tab draws 2 px bottom border.
- **State sources:**
  - Tab selection is read from the URL query `?tab=` using `useSearchParams` and updated via `router.push`.
  - Tab-specific modes saved through `usePreference` (database-backed) except Budget, which still polls `localStorage` (`budget_mode_{projectId}`) every two seconds.
- **Pain points:** The `<select>` grows to 320 px and can overflow on 1024 px viewports; there is no search, and the tab list can overflow horizontally when both land-development and income-property tabs render.

### 1.3 Ancillary Navigation Surfaces
- **Sandbox / Developer links:** `SandboxDropdown` (`src/app/components/navigation/SandboxDropdown.tsx:1`) lists every prototype route (Budget Grid, GIS test, Document Review, etc.). It is the only entry point to most prototypes.
- **Admin nav:** `AdminNavBar` (`src/app/components/AdminNavBar.tsx:1`) mirrors the tab bar for `/admin/*` routes. It is sticky at `top:58px` and exposes Preferences, Benchmarks, Cost Library, and DMS Admin (links to `/admin/dms/templates`).
- **Preferences nav:** `PreferencesContextBar` (`src/app/components/PreferencesContextBar.tsx:1`) is a simplified copy of `ProjectContextBar` that sits directly under the top bar (no offset) and keeps the `tab` query string in sync.
- **Legacy vertical nav:** `src/app/components/layout/vertical/Navigation.tsx` still ships the Materio sidebar (MUI + `@menu/vertical-menu`). It is only mounted inside older prototype pages such as `/projects/[projectId]/overview`.
- **Route-level wrappers:** `NavigationLayout` (`src/app/components/NavigationLayout.tsx:1`) wraps the entire app (see `src/app/layout.tsx:1`) and can hide navigation for future auth/marketing routes via `hideNavigation` prop.

### 1.4 Route Structure

**Note on Dual-Access Pattern:** Several features can be accessed BOTH as tabs within `/projects/[projectId]?tab=X` AND as standalone routes. This pattern provides deep-linking and focused workflows:
- **Budget**: Tab (`?tab=budget`) or route (`/projects/[projectId]/budget`)
- **Valuation**: Tab (`?tab=valuation`) or route (`/projects/[projectId]/valuation`)
- **Operations (OpEx)**: Tab (`?tab=operations`) or routes (`/projects/[projectId]/opex`, `/opex-accounts`)
- **Planning**: Tab (`?tab=planning`) or route (`/planning` - hardcoded to project 7)

Representative tree of `src/app` (pages without `page.tsx` are omitted):

```
/ (redirects to /dashboard)
â”œâ”€â”€ dashboard
â”œâ”€â”€ dms
â”œâ”€â”€ planning (standalone, defaults to project 7)
â”œâ”€â”€ reports
â”œâ”€â”€ rent-roll
â”œâ”€â”€ documents
â”‚   â””â”€â”€ review
â”œâ”€â”€ ai-document-review
â”œâ”€â”€ market, market-assumptions, inventory
â”œâ”€â”€ projects
â”‚   â”œâ”€â”€ [projectId]
â”‚   â”‚   â”œâ”€â”€ page (tab host - renders based on ?tab= query param)
â”‚   â”‚   â”œâ”€â”€ layout (injects ProjectContextBar + ComplexityModeProvider)
â”‚   â”‚   â”œâ”€â”€ overview (legacy Materio page)
â”‚   â”‚   â”œâ”€â”€ budget (standalone budget page with scope/stage filters)
â”‚   â”‚   â”œâ”€â”€ valuation (standalone valuation page - three approaches)
â”‚   â”‚   â”œâ”€â”€ assumptions (standalone assumptions editor)
â”‚   â”‚   â”œâ”€â”€ settings (project settings page)
â”‚   â”‚   â”œâ”€â”€ opex (multifamily operating expenses editor)
â”‚   â”‚   â””â”€â”€ opex-accounts (Chart of Accounts hierarchy viewer)
â”‚   â””â”€â”€ setup (project creation wizard)
â”œâ”€â”€ admin
â”‚   â”œâ”€â”€ preferences
â”‚   â”œâ”€â”€ benchmarks
â”‚   â”‚   â””â”€â”€ cost-library
â”‚   â””â”€â”€ dms
â”‚       â””â”€â”€ templates
â”œâ”€â”€ preferences (global tabs â†’ product library & taxonomy)
â”œâ”€â”€ settings
â”‚   â”œâ”€â”€ taxonomy (land use taxonomy manager)
â”‚   â””â”€â”€ budget-categories (budget category management)
â”œâ”€â”€ benchmarks
â”‚   â”œâ”€â”€ unit-costs
â”‚   â””â”€â”€ products
â”œâ”€â”€ growthrates (Materio version)
â”œâ”€â”€ growthrates-original
â”œâ”€â”€ growthratedetail
â”œâ”€â”€ growthratesmanager
â”œâ”€â”€ prototypes
â”‚   â”œâ”€â”€ page (prototypes hub)
â”‚   â”œâ”€â”€ [prototypeId] (dynamic prototype routes)
â”‚   â””â”€â”€ multifam
â”‚       â””â”€â”€ rent-roll-inputs
â”‚           â”œâ”€â”€ page (main rent roll prototype)
â”‚           â””â”€â”€ content (nested content page)
â”œâ”€â”€ prototypes-multifam (multifamily prototypes index)
â”œâ”€â”€ lease/[id] (legacy lease detail)
â”œâ”€â”€ property/[id] (legacy property detail)
â”œâ”€â”€ properties/[id]/analysis (legacy property analysis)
â”œâ”€â”€ gis-test, gis-simple-test, map-debug, parcel-test
â”œâ”€â”€ db-schema (database schema viewer)
â”œâ”€â”€ test-coreui (CoreUI testing page)
â””â”€â”€ misc sandbox routes: budget-grid(+v2), breadcrumb-demo, documentation, dev-status, etc.
```

**Dynamic segments:**
- **Project routes:** `/projects/[projectId]/*` (tab host, budget, valuation, assumptions, settings, opex, opex-accounts, overview)
- **Prototype routes:** `/prototypes/[prototypeId]`
- **Legacy routes:** `/lease/[id]`, `/property/[id]`, `/properties/[id]/analysis`

### 1.5 Project Context Switching
- **Provider:** `ProjectProvider` (`src/app/components/ProjectProvider.tsx:1`) wraps the entire app in `src/app/layout.tsx:12`. It loads `/api/projects` through SWR, caches results, and stores the last project ID in `localStorage` (`activeProjectId`).
- **Selection surfaces:**
  - `ProjectContextBar` dropdown (primary way during project work).
  - `Dashboard` table rows call `selectProject(project)` then push `/projects/{id}` (`src/app/dashboard/page.tsx:57`). Note: the handler mistakenly passes the project object to `selectProject`, so switching from the dashboard relies on the dropdown to actually change context.
  - `NewProjectModal` (`src/app/components/NewProjectModal.tsx:1`) refreshes projects, selects the new ID, and navigates the user to `/projects/{id}` after creation.
- **Persistence:** Provider rehydrates from storage on mount and automatically falls back to the first project returned by `/api/projects` if the stored ID is missing.
- **Propagation:** `useProjectContext` is consumed by DMS, Planning, and numerous tab components to show project-specific data. Outside `/projects/*` routes there is no visible selector, so users must return to a project page to change contextâ€”this is one of the pain points driving the redesign.

### 1.6 Tab Implementations
| Surface | Component / File | Behavior |
| --- | --- | --- |
| Project tabs | `ProjectContextBar` (`src/app/components/ProjectContextBar.tsx:1`) | Stateless buttons hooked to URL query; displays `ModeChip`s driven by `usePreference`. |
| DMS tabs | `LandscapeButton` pills in `src/app/dms/page.tsx:261` (also exported in `DMSView`) | Manual state stored in `useState<TabType>`; optionally synchronized with `?tab` on first load. |
| Budget subtabs | `BudgetGridTab` (`src/components/budget/BudgetGridTab.tsx:36`) uses `useState<'grid' \| ...>` plus CoreUI `CNav` for grouping toggle inside the card. |
| Admin nav | `AdminNavBar` (see above) uses Next `<Link>` objects with pure CSS for active state. |
| Preferences | `PreferencesContextBar` controls `?tab=` query, rendering dynamic imports per tab. |
| **Operations** | `OperationsTab` (`src/app/projects/[projectId]/components/tabs/OperationsTab.tsx:1`) **renders different UIs based on project type:** For `LAND` projects â†’ `OpExHierarchy` (Chart of Accounts). For `MF` projects â†’ `NestedExpenseTable` with benchmarks. For other types â†’ "Coming Soon" placeholder. |
| Planning | `PlanningTab` wraps `PlanningContent` for `LAND` projects; shows educational card for other types. |
| Sales & Absorption | `SalesTab` renders `SalesContent` for `LAND` projects, otherwise shows guidance card. `SalesContent` orchestrates area/phase filters, pricing tables, inventory gauges, and parcel sales grid. |
| Property | `PropertyTab` shows multifamily rent roll interface with Floor Plan Matrix, Comparable Rentals, Detailed Rent Roll sections (currently mock data). |
| Valuation | `ValuationTab` has sub-tabs (Sales Comparison/Cost/Income) using button toggles; only Sales Comparison is active. |
| Feasibility | `FeasibilityTab` has sub-tabs (Sales Comparison/Residual/Cash Flow) - all currently disabled/placeholder. |
| Capitalization | `CapitalizationTab` - placeholder for future capitalization modeling. |
| Reports | `ReportsTab` renders report-type selector and scenario toggle; embeds `PropertySummaryView`. |
| Documents | `DocumentsTab` embeds `DMSView` scoped to active project. |
| Document Review | Uses Radix Tabs (`src/app/documents/review/page.tsx:37`) for queue / detail / analytics; default tab is "queue". |
| Project-specific prototypes | Many smaller surfaces reuse `LandscapeButton` toggles (e.g., `/projects/[projectId]/budget/page.tsx:27`). |

**Tab Sets by Property Type**

`getTabsForPropertyType` (`src/lib/utils/projectTabs.ts:1`) returns two canonical configurations:

| Project Type | Tabs (in order) | Notes |
| --- | --- | --- |
| **Land Development** (`LAND`, `MPC`, `Subdivision`, etc.) | `project`, `planning`, `budget`, `operations`, `sales`, `feasibility`, `capitalization`, `reports`, `documents` | Sales & Absorption and Feasibility are only wired for land workflows today. |
| **Income / Multifamily** (`MF`, `OFF`, `RET`, `IND`, `MXU`, `HTL`) | `project`, `property`, `operations`, `valuation`, `capitalization`, `reports`, `documents` | Property/Operations/Valuation tabs are the only ones with meaningful UI; other commercial-specific tabs are placeholders pending requirements. |

All other property-type codes currently fall back to the income set, but their tab content is either undeveloped or reuses shared components. Documenting this split clarifies why some designs exist only for land or multifamily.

Tab state is not centralized; every surface maintains its own `useState` or query param, which complicates global navigation changes.

### 1.7 Header and Breadcrumb Patterns
- **Standard header:** `PageHeader` (`src/components/ui/PageHeader.tsx:1`) renders a breadcrumb ordered list plus action slots. Only a handful of prototype pages import it today; most major screens still craft headers manually.
- **Dynamic breadcrumbs:** `DynamicBreadcrumb` (`src/app/components/DynamicBreadcrumb.tsx:1`) adapts copy (Area/Phase/Parcel vs Property/Building/Unit) based on `useProjectConfig`. Currently used in the breadcrumb demo and GIS planning cards; production screens have not wired it in yet.
- **Ad-hoc breadcrumbs:**
  - DMS documents tab outputs `Home > Projects > {Project Name}` using `LandscapeButton`s (`src/app/dms/page.tsx:306`).
  - Land Use Taxonomy page ships its own CSS/HTML breadcrumb (`src/app/settings/taxonomy/page.tsx:90`).
- **Color hierarchy:** `docs/HEADER_COLOR_HIERARCHY.md` defines the header palette backed by CSS variables in `src/styles/tokens.css`. The design tokens are already applied in `BudgetDataGrid`, `BenchmarkAccordion`, and other components to standardize header backgrounds.

---

## 2. Page Inventory
For each page, the summary reflects the current code in `/src` as of this snapshot. Routes reachable only through the sandbox dropdown are marked as **prototype** but still documented when they influence workflow decisions.

### Dashboard (`/dashboard`)
**Purpose:** Landing experience after `/` auto-redirect. Shows overall project list, highlights, and an entry point for creating or selecting projects.

**Layout:**
- Headerless `CContainer` with padding 16 px (see `src/app/dashboard/page.tsx:34`).
- Top row: two-column split with `UserTile` (AI prompt panel) and `DashboardMap` (project markers). Height locked to ~500 px.
- Middle: five CoreUI stat cards (projects, active, land dev, income properties, New Project CTA).
- Bottom: full-width CoreUI table listing all projects with clickable rows.

**Key Components:**
- `UserTile` (`src/app/components/dashboard/UserTile.tsx`) â€“ chat-like input connected to `handleLandscaperMessage` (console stub).
- `DashboardMap` (`src/app/components/dashboard/DashboardMap.tsx`) â€“ MapLibre or Leaflet-based map showing `projects` from context.
- `NewProjectModal` â€“ toggled by clicking the "New Project" card; handles form, uploads, and auto-navigation after creation.

**Data Sources:**
- `useProjectContext` for list of projects (SWR-loaded from `/api/projects`).
- Map component consumes same context data plus geocoding utilities.

**User Interactions:**
- Row click: `handleProjectClick` attempts to call `selectProject(project)` (bug: signature expects ID) and uses `router.push`.
- New project button: opens modal (multi-step form using React Hook Form and Zod validation).
- UserTile submit: logs message for future AI integration.

**Navigation:**
- Accessible directly from top nav (Dashboard pill) and `/` redirect.
- Table rows/CTA push into `/projects/{projectId}`.

### Project Workspace (`/projects/[projectId]`)
**Purpose:** Multi-tab workspace acting as the "Project Overview" area called out in requirements.

**Layout:**
- `ProjectContextBar` across the top for project + tab selection.
- Tab host component `src/app/projects/[projectId]/page.tsx` reads `?tab=` and renders one of the imported tab modules.
- Each tab uses CoreUI cards, grid layouts, or custom tables depending on domain. The available tabs depend on property type:
  - **Land Development projects** expose `Planning`, `Budget`, `Sales`, `Feasibility`, `Capitalization`, `Reports`, `Documents`, plus legacy `Sources/Uses/GIS`.
  - **Multifamily/Income-type projects** expose `Property`, `Operations`, `Valuation`, `Capitalization`, `Reports`, `Documents`. Other commercial project types still reuse these income templates until feature work lands.

**Key Components:**
- `ProjectTab` (massive detail view with contact sections, location editing, inflation schedule modal, etc.).
- `PlanningTab` â€“ wraps `PlanningContent` for Land projects, otherwise shows an educational card.
- `BudgetTab` â€“ thin wrapper around `BudgetContainer` (see Budget section).
- `SalesTab`, `OperationsTab`, etc. â€“ mostly prototypes with placeholder data but still shipping UI.
- `ReportsTab` â€“ described later.
- `DocumentsTab` â€“ embeds `DMSView` scoped to the active project.

**Data Sources:**
- Each tab fetches its own API slice (`/api/projects/{id}/details`, `/api/budget/...`, `/api/parcels`, etc.).
- Shared contexts: `useProjectContext`, `ComplexityModeProvider`, `ScenarioProvider` (inside some tabs).

**Interactions:**
- Tab switching rewrites `?tab` query (no `history.replace`, so each click pushes a new entry).
- Many modals (`BudgetItemModalV2`, `NewProjectModal`, scenario modals) are local to tabs.

**Navigation:**
- Entry points: Dashboard, `ProjectContextBar` dropdown, sandbox links.
- Each tab may deep-link to sub-routes (e.g., `?tab=budget`).

### Budget (`/projects/[projectId]?tab=budget`, `/projects/[projectId]/budget`, `/budget-grid`, `/budget-grid-v2`)
**Purpose:** Provide grid, timeline, and analysis views of development budgets.

**Layout & Tabs:**
- Inside the main tab: `BudgetContainer` -> `BudgetGridTab` (default) plus placeholders for `TimelineTab`, `AssumptionsTab`, `AnalysisTab`.
- Standalone `/projects/[projectId]/budget` route renders `BudgetGridWithTimeline` with additional scopes (Project/Area/Phase) and Stage filters.
- Legacy `/budget-grid` and `/budget-grid-v2` pages mount MUI-based prototypes and rely on manual project selectors.

**Key Components:**
- `BudgetGridTab` (`src/components/budget/BudgetGridTab.tsx:36`): orchestrates mode selection, filters, container filters, and orchestrates `BudgetDataGrid`.
- `BudgetDataGrid` (`src/components/budget/BudgetDataGrid.tsx:1`): TanStack table with optional grouping, inline editing, custom expandable rows, virtualization per mode.
- `BudgetItemModalV2`, `QuickAddCategoryModal`, `TimelineChart`, `FiltersAccordion`, `AssumptionsTab`, `AnalysisTab`.

**Data Sources:**
- `useBudgetData` hook fetches `/api/budget/gantt?projectId=` and normalizes rows.
- `BudgetDataGrid` optionally fetches variance data via `useBudgetVariance` hook and category metadata through `useBudgetGrouping`.
- Container filters rely on `/api/projects/{id}/containers` via `useContainers`.

**Interactions:**
- Mode selector persists per project in `localStorage`.
- Group button toggles aggregated view (persisted preference via `useBudgetGrouping`).
- Inline editing triggers `onInlineCommit` to call `/api/budget/gantt/items/{factId}` (see hook).
- Timeline toggle shows `TimelineChart`; `TimelineTab` placeholder describes future Gantt layout.

**Navigation:**
- Access via Project tab, sandbox (`/budget-grid`), or old direct route `/projects/{id}/budget`.

### Planning (`/planning`, `/projects/[projectId]?tab=planning`)
**Purpose:** Manage Areas/Phases/Parcels for land development projects.

**Layout:**
- Standalone `/planning` defaults to project ID 7 (Peoria Lakes) and wraps `PlanningContent` inside a full-height container with neutral background.
- Project tab version shares the same component when property type code is `LAND`, otherwise displays a message.

**Key Components:**
- `PlanningContent` (`src/app/components/Planning/PlanningContent.tsx:1`): orchestrates parcel/phase fetching via SWR, area cards, filtering, editing modals, and integration with `PlanningWizard` components.
- `PlanningOverviewControls`, `CollapsibleSection`, `ParcelDetailCard`, etc.

**Data Sources:** `/api/parcels?project_id=`, `/api/phases?project_id=`, `useProjectConfig` for naming, `window` events for cross-component refresh.

**Interactions:**
- Selecting an area opens detail cards; editing emits custom events to refresh data.
- Modeled to support PDF import, though that path is stubbed today.

**Navigation:**
- Accessible via project tab (land-only) and sandbox link.

### Reports (`/reports`, `/projects/[projectId]?tab=reports`)
**Purpose:** Provide financial reporting outputs and PDF exports.

**Layout:**
- `/reports` page has static property ID 17 for now; header includes scenario selector and embeds `PropertySummaryView`.
- Project `ReportsTab` adds a report-type selector (Property Summary / Cash Flow / Rent Roll) and scenario toggle.

**Key Components:**
- `PropertySummaryView` (`src/components/reports/PropertySummaryView.tsx:1`): fetches metrics from backend (`${NEXT_PUBLIC_BACKEND_URL}/api/reports/calculate/noi/{property}`) and renders metric cards + CoreUI table.
- CoreUI components for buttons, nav pills.

**Data Sources:** remote backend service; scenario toggles simply change query parameter.

**Interactions:**
- Buttons open PDF endpoints in a new tab.
- Scenario toggle uses CoreUI button group with active state.

**Navigation:**
- `/reports` reachable from sandbox; the tab is part of `ProjectContextBar` for both land and income projects.

### Sales & Absorption (`/projects/[projectId]?tab=sales`)
**Purpose:** Dedicated land-development workspace for managing lot inventory, pricing, and absorption assumptions.

**Layout:**
- Entire view comes from `SalesContent` (`src/components/sales/SalesContent.tsx`) wrapped by `SalesTab`. Non-land projects see an educational card explaining why the tab is unavailable.
- Page body is split into stacked `CollapsibleSection`s:
  - **Annual Inventory Gauge** â€“ top section displaying `AnnualInventoryGauge` visualization for selected project.
  - **Areas & Phases vs Land Use Pricing** â€“ two-column grid (5/12 + 7/12). Left column contains `AreaTiles` and custom `PhaseTiles` so users can multi-select geography; right column renders the `PricingTable` filtered by phase selection.
  - **Parcel Sales Table** â€“ full-width section with `ParcelSalesTable` summarizing absorption pipeline. Header text dynamically reflects applied filters, and `CBadge` "Clear Filters" button appears when selections are active.

**Key Components:**
- `AreaTiles` (`src/components/shared/AreaTiles.tsx`) & `PhaseTiles` (`src/components/sales/PhaseTiles.tsx`) reuse the planning tile pattern with cost overlays when `showCosts` is true.
- `PricingTable` (`src/components/sales/PricingTable.tsx`) â€“ shows land-use specific price ladders with filtering by phase.
- `ParcelSalesTable` (`src/components/sales/ParcelSalesTable.tsx`) â€“ detailed grid of parcels, status, buyer, price, absorption month.
- `AnnualInventoryGauge` (`src/components/sales/AnnualInventoryGauge.tsx`) â€“ radial gauge built on recharts (or custom SVG) giving at-a-glance metrics.

**Data Sources:**
- Each component fetches project-specific sales data via REST endpoints (e.g., `/api/sales/areas`, `/api/sales/phases`, `/api/sales/pricing`, `/api/sales/parcels`). Selection state is fully client-side.

**User Interactions:**
- Tile clicks toggle filters; `handleAreaSelect` and `handlePhaseSelect` maintain multi-select arrays.
- Filters cascade: clearing areas also clears phases to avoid inconsistent selections.
- Collapsible sections remember open state per render and expose action slots for badges.

**Navigation:**
- Only available on projects tagged with `project_type_code === 'LAND'`. Part of the default tab set returned by `getTabsForPropertyType`.

### Documents (DMS) (`/dms`, `/projects/[projectId]?tab=documents`, `/documents/review`)
**Purpose:** Document management and AI review.

**Layout:**
- `/dms` page uses a vertical flex container occupying the viewport.
  - Top: `LandscapeButton`-based tabs (Documents / Upload).
  - Document tab includes breadcrumb row, toolbar, filter accordions (two columns), detail panel when accordion items clicked, and `ProfileForm` for metadata.
  - Upload tab splits the screen between `Dropzone`, `Queue`, and profile editor.
- `DocumentsTab` inside projects renders `DMSView` with `hideHeader=false`, so it duplicates the same UI but respects the active project from context.

**Key Components:**
- `DMSView` (`src/components/dms/DMSView.tsx:1`) â€“ shared logic used in both contexts.
- `AccordionFilters`, `FilterDetailView`, `Dropzone`, `Queue`, `ProfileForm`.

**Data Sources:**
- Document types from `/api/dms/templates/doc-types` (project_id + workspace).
- Counts from `/api/dms/filters/counts`.
- Filter detail results from `/api/dms/search`.
- Upload path proxies to `/api/dms/upload` (implementation inside `Dropzone`).

**Interactions:**
- Tab changes persisted per session (URL search for first load only).
- Filter accordion expands fetch documents lazily.
- Upload queue tracks status (pending â†’ completed) and surfaces metadata editing once processed.
- When no project is selected, `/dms` renders a yellow alert instructing the user to pick a project elsewhereâ€”a direct symptom of missing global context selector outside `/projects/*` routes.

**Navigation:**
- Primary nav "Documents" pill links here.
- `SandboxDropdown` exposes Document Review and AI Document Review prototypes as separate routes.

### GIS / Map Views (`/gis-test`, `/gis-simple-test`, `/map-debug`, `/parcel-test`, `/map-debug`)
**Purpose:** Support GIS ingestion, parcel navigation, and debugging workflows.

**Key Components:**
- `GISSetupWorkflow`, `ProjectStructureChoice`, `PropertyPackageUpload`, and `PlanNavigation` (`src/app/components/GIS/PlanNavigation.tsx:1`).
- `GISMap` (`src/app/components/MapLibre/GISMap.tsx:1`) â€“ MapLibre integration with tile sources, parcel selection, geocoding, and selection modes.

**Data Sources:** `/api/gis/plan-parcels`, `/api/projects/{id}/choose-structure`, `/api/ai/ingest-property-package`, etc. Map uses MapLibre GL and optionally Turf for geometry operations.

**Interactions:**
- GISTest page lets the user switch between workflow steps; some steps show fullscreen map, others show dashboard-like cards.
- GIS Simple Test page offers API diagnostics with live logs.
- Map Debug page renders full-screen MapLibre view with instructions overlayed.

**Navigation:** Sandbox dropdown only.

### Reports & Document AI Prototypes (`/documents/review`, `/ai-document-review`)
- `/documents/review` implements a three-tab Radix interface for AI extraction review, detail correction, and analytics (QueueTab/DetailTab/AnalyticsTab). Data is currently mocked but the UI demonstrates the intended workflow.
- `/ai-document-review` is a separate prototype page exploring AI review in isolation.

### Admin Pages
1. **Global Benchmarks** (`/admin/benchmarks`):
   - Uses `AdminNavBar` + split-pane layout.
   - Loads benchmark registry (`/api/benchmarks`), sale benchmarks, AI suggestions, absorption velocity, and unit-cost templates in parallel.
   - Contains `BenchmarkAccordion`, `GrowthRateCategoryPanel`, `AbsorptionVelocityPanel`, `BenchmarksFlyout`, `AddBenchmarkModal`.
   - Offers left/right resizing and quick actions (AI suggestions) for future integration.
2. **Cost Library** (`/admin/benchmarks/cost-library`):
   - Houses `CostLibraryManager` (not covered earlier) for editing unit cost templates.
3. **DMS Templates Admin** (`/admin/dms/templates`):
   - CRUD form for document templates (see file earlier). Uses CoreUI forms and interacts with `/api/dms/templates`.
4. **Admin Preferences** (`/admin/preferences`):
   - Currently a placeholder referencing `PreferencesContextBar`. Most "preferences" content moved under `/preferences` or `/admin/benchmarks`.

### Preferences (`/preferences`)
- Primary tabs are `Product Library` and `Land Use Manager` (taxonomy). Page uses query string to control dynamic imports.
- `ProductLibraryPanel` manages lot products, types, and planning standards; fetches `/api/products`, `/api/land-use/types`, `/api/planning-standards` and provides modals for CRUD.
- `Taxonomy` page renders three columns (FamilyTree, FamilyDetails, ProductsList) with inline breadcrumb linking back to `/settings` (legacy reference).

### Operating Expenses - Multifamily (`/projects/[projectId]/opex`, `/projects/[projectId]?tab=operations`)

**Purpose:** Manage multifamily operating expenses with complexity mode support (Napkin/Standard/Detail).

**Dual Access:**
- **Tab:** Accessible via `?tab=operations` for `MF` projects (renders `OperationsTab` with `NestedExpenseTable`)
- **Standalone Route:** `/projects/[projectId]/opex` provides focused operating expense editor

**Layout (Standalone `/opex` page):**
- Header with project title
- `ModeToggle` component for Napkin/Standard/Detail selection
- Operating expense form with field visibility based on complexity tier
- Save/cancel buttons

**Layout (Operations Tab - MF projects):**
- Summary metrics bar (4 tiles: Total OpEx, Per Unit, Per SF, Expense Ratio)
- Two-column grid:
  - Left (2/3): `NestedExpenseTable` with hierarchical expense rows
  - Right (1/3): `BenchmarkPanel` showing market comparison
- Restore notice banner (when reverting to previous mode)
- Unsaved changes floating action button

**Key Components:**
- `NestedExpenseTable` (`src/app/prototypes/multifam/rent-roll-inputs/components/NestedExpenseTable.tsx`) - hierarchical expense table with expand/collapse, inline editing, category filters
- `BenchmarkPanel` (`src/app/prototypes/multifam/rent-roll-inputs/components/BenchmarkPanel.tsx`) - market benchmark comparison
- `ModeToggle` (`src/components/shared/ModeToggle.tsx`) - complexity mode selector
- `ConfigureColumnsModal` - column visibility configuration

**Data Sources:**
- `/api/projects/{id}/operating-expenses/hierarchy` - Chart of Accounts data
- `/api/projects/{id}/opex` - Operating expense CRUD
- Complexity mode persisted via `ComplexityModeProvider`

**User Interactions:**
- Mode switching triggers data preservation/restoration
- Inline editing of expense amounts, escalation rates, recoverable flags
- Category filter chips (Taxes, Insurance, Utilities, R&M, Management, Other)
- Column configuration modal
- Expand/collapse hierarchical rows

**For LAND Projects:** Operations tab shows `OpExHierarchy` component instead (see Chart of Accounts section below).

### Chart of Accounts Hierarchy (`/projects/[projectId]/opex-accounts`, Operations Tab for LAND)

**Purpose:** View and manage Chart of Accounts hierarchy for operating expenses.

**Layout:**
- `OpExHierarchy` component (`src/app/components/OpExHierarchy.tsx`) displays account tree
- Account numbers, names, calculated totals
- Hierarchical indentation showing parent-child relationships

**Data Sources:**
- `/api/projects/{id}/operating-expenses/hierarchy`
- `/api/projects/{id}/operating-expenses/[accountId]` - individual account details
- `/api/projects/{id}/operating-expenses/inventory-stats` - inventory statistics

**Used In:**
- Operations tab for `LAND` projects
- `/projects/[projectId]/opex-accounts` standalone route

### Valuation (`/projects/[projectId]/valuation`, `/projects/[projectId]?tab=valuation`)

**Purpose:** Property valuation using three approaches (Sales Comparison, Cost, Income).

**Layout:**
- Navigation component with approach toggles
- Active approach content area
- Refresh button
- **Sales Comparison Approach** (active):
  - ComparablesGrid component
  - ComparablesMap showing comparable locations
  - Indicated Value Summary
  - Landscaper Chat Panel for AI assistance
- **Cost Approach** (coming soon placeholder)
- **Income Approach** (coming soon placeholder)

**Key Components:**
- `ComparablesGrid` (`src/app/projects/[projectId]/valuation/components/ComparablesGrid.tsx`)
- `ComparablesMap` (`src/app/projects/[projectId]/valuation/components/ComparablesMap.tsx`)
- `IndicatedValueSummary` (`src/app/projects/[projectId]/valuation/components/IndicatedValueSummary.tsx`)
- `LandscaperChatPanel` (`src/app/projects/[projectId]/valuation/components/LandscaperChatPanel.tsx`)

**Navigation:**
- Accessible as tab (`?tab=valuation`) or standalone route
- Three sub-approaches selectable via button toggles

### Settings & Configuration

#### Budget Categories (`/settings/budget-categories`)
**Purpose:** Manage budget category taxonomy and templates.

**Features:**
- Category tree management
- Template assignment
- CRUD operations for categories

#### Taxonomy Manager (`/settings/taxonomy`)
**Purpose:** Manage land use taxonomy (families, products).

**Layout:** Three-column interface
- Left: `FamilyTree` - hierarchical family list
- Center: `FamilyDetails` - selected family details
- Right: `ProductsList` - products under selected family

**Features:**
- Inline breadcrumb navigation
- Family/product CRUD
- Taxonomy relationship management

### Benchmarks

#### Unit Costs (`/benchmarks/unit-costs`)
**Purpose:** Manage unit cost benchmarks library.

**Features:**
- Unit cost templates by category
- Color-coded category palette
- CRUD operations
- Used by Budget and Planning workflows

#### Products (`/benchmarks/products`)
**Purpose:** Manage product-level benchmarks.

**Features:**
- Product benchmark registry
- Association with land use types
- Planning standard integration

### Growth Rate Management

Four interconnected pages for managing growth rate assumptions:

#### Growth Rates - Materio (`/growthrates`)
**Purpose:** Main growth rate management interface (Materio theme).

**Features:**
- Growth rate by category
- Historical data
- Forecast modeling

#### Growth Rates Original (`/growthrates-original`)
**Purpose:** Legacy growth rates interface.

#### Growth Rate Detail (`/growthratedetail`)
**Purpose:** Detailed view/edit for individual growth rate.

#### Growth Rates Manager (`/growthratesmanager`)
**Purpose:** Administrative growth rate management.

### Rent Roll (`/rent-roll`)
**Purpose:** Rent roll management and analysis.

**Features:**
- Unit-level rent data
- Lease expiration tracking
- Rent roll projections

### Sandbox & Developer Tools

#### Database Schema (`/db-schema`)
**Purpose:** Interactive database schema documentation.

**Features:**
- Table/column browsing
- Relationship visualization
- Data dictionary

#### Test CoreUI (`/test-coreui`)
**Purpose:** CoreUI component testing sandbox.

**Features:**
- Component gallery
- Theme testing
- Interactive examples

#### Prototypes Hub (`/prototypes`)
**Purpose:** Index of all prototype pages.

**Features:**
- Categorized prototype list
- Status badges (active/experimental/archived)
- Direct links to each prototype

#### Prototypes Multifam (`/prototypes-multifam`)
**Purpose:** Multifamily-specific prototypes index.

**Features:**
- Multifamily prototype registry
- Categorization by workflow
- Status tracking

#### Development Status (`/dev-status`)
**Purpose:** Internal development dashboard.

**Features:**
- Feature completion tracking
- Component inventory
- Implementation status

#### Documentation Center (`/documentation`)
**Purpose:** Internal documentation hub.

**Features:**
- Technical docs index
- API documentation
- Component guides

### Legacy Routes (Materio-Based Prototypes)

#### Lease Detail (`/lease/[id]`)
**Purpose:** Legacy lease detail page (Materio theme).

**Features:**
- Lease overview section
- Terms and dates
- Tenant information
- Financial details

#### Property Detail (`/property/[id]`)
**Purpose:** Legacy property detail page (Materio theme).

#### Property Analysis (`/properties/[id]/analysis`)
**Purpose:** Legacy property financial analysis (Materio theme).

**Features:**
- Quick stats dashboard
- Multiple analysis tabs
- Financial metrics
- Sensitivity analysis

### Prototype/Test Routes in Active Use
- `/budget-grid` and `/budget-grid-v2` (MUI-based grids still used for exploring virtualization/perf).
- `/prototypes/multifam/rent-roll-inputs` (multifamily rent-roll workflow with dedicated PageHeader component).
- `/breadcrumb-demo` (reference for breadcrumb component adoption).
- `/projects/setup` (project setup wizard wrapper that launches `NewProjectModal` flow in full screen).

---

## 3. Component Architecture
This section highlights the principal layout/navigation/data components referenced elsewhere.

### NavigationLayout
**File:** `src/app/components/NavigationLayout.tsx:1`
**Purpose:** Provides the universal flex column shell with optional ability to hide navigation.

```typescript
interface NavigationLayoutProps {
  children: React.ReactNode;
  hideNavigation?: boolean;
}
```
**Used By:** Wrapped around every page inside `src/app/layout.tsx`.
**Children:** `TopNavigationBar` + `<main>{children}</main>`.
**Styling:** Tailwind `flex min-h-screen flex-col`; theme colors inherited from `CoreUIThemeProvider`.

### TopNavigationBar
**File:** `src/app/components/TopNavigationBar.tsx:1`
**Purpose:** Tier-1 navigation with contextual tools.
**Props Interface:** None (functional component using hooks).
**Used By:** `NavigationLayout`.
**Children:** Logo, nav links, `SandboxDropdown`, `UserMenuDropdown`, `SettingsDropdown`, theme toggle, bug reporter, `LandscaperChatModal`.
**Styling:** Inline CSS using CSS variables for nav background/borders defined in `tokens.css`.

### ProjectContextBar
**File:** `src/app/components/ProjectContextBar.tsx:1`
**Purpose:** Tier-2 navigation for project-specific work.
**Props:** `projectId: number`.
**Used By:** `projects/[projectId]/layout.tsx`.
**Children:** `<select>` for project selection, horizontal button list with optional `ModeChip`s.
**Styling:** Sticky bar with manual inline colors referencing CoreUI semantic vars.

### PreferencesContextBar & AdminNavBar
- Similar structure to `ProjectContextBar` but limited to static label or admin categories. Both rely on inline styles referencing CoreUI variables for consistent look.

### SandboxDropdown / UserMenuDropdown / SettingsDropdown
- **Files:** `src/app/components/navigation/*.tsx`.
- **Purpose:** Provide overflow navigation (prototype index, account, settings).
- **Props:** None. Each uses local `useState` + `useOutsideClick` to manage open state.
- **Styling:** Transparent buttons inheriting nav colors; dropdown panels styled with CoreUI variables and `Z_INDEX` constants.

### PageHeader
**File:** `src/components/ui/PageHeader.tsx:1`
**Purpose:** Standardized header with breadcrumb list + actions slot.
**Props Interface:**
```typescript
interface PageHeaderProps {
  breadcrumbs: { label: string; href?: string }[];
  actions?: React.ReactNode;
}
```
**Used By:** Multifamily prototype and ready for adoption across tabs.
**Styling:** Border-bottom referencing `var(--cui-border-color)`.

### DynamicBreadcrumb
**File:** `src/app/components/DynamicBreadcrumb.tsx:1`
**Purpose:** Render breadcrumbs with project-aware labels.
**Props:** `items: BreadcrumbItem[]` plus optional `className`.
**Used By:** Breadcrumb demo / GIS prototypes; available for DMS/planning adoption.
**Children:** `<ol>` with `ChevronRight` separators.

### LandscapeButton
**File:** `src/components/ui/landscape/LandscapeButton.tsx:1`
**Purpose:** Wrapper around `CButton` with optional icon, loading state.
**Props Interface:** Extends `CButtonProps` with `loading`, `icon`, `iconRight`.
**Used By:** DMS tabs, Budget prototypes, `BudgetPage` header actions, Document breadcrumbs, etc.
**Styling:** Relies on CoreUI theme so it stays consistent regardless of global scheme.

### ModeChip
**File:** `src/components/ui/ModeChip.tsx:1`
**Purpose:** Visual indicator of Napkin/Standard/Detail modes.
**Props:** `mode: 'napkin' | 'standard' | 'detail'`.
**Used By:** `ProjectContextBar` tab items.
**Styling:** `CTooltip` + small square colored via CSS variables.

### Budget Stack
- **BudgetDataGrid** (`src/components/budget/BudgetDataGrid.tsx:1`): Table built with TanStack Table and inline virtualization. Accepts `data`, `mode`, callbacks for row selection/editing.
- **BudgetGridTab**: orchestrates filter state, mode persistence, hooking `useBudgetData`.
- **Hooks:** `useBudgetData`, `useBudgetGrouping`, `useBudgetVariance`, `useContainers` for data & preferences.
- **Modals:** `BudgetItemModalV2`, `QuickAddCategoryModal`, `ConfigureColumnsModal`.

### Planning Components
- `PlanningContent` uses SWR for parcels/phases and composes `PlanningOverviewControls`, `CollapsibleSection`, `ParcelDetailCard` from `PlanningWizard` modules.
- Uses custom event bus (`window.dispatchEvent('dataChanged')`) to invalidate data.

### GIS Components
- `GISMap` handles MapLibre initialization, raster layers, parcel highlighting, and event callbacks.
- `PlanNavigation` uses `GISMap` and renders context panels with breadcrumbs and confidence controls.

### Operations/OpEx Components

**OpExHierarchy**
- **File:** `src/app/components/OpExHierarchy.tsx`
- **Purpose:** Displays Chart of Accounts hierarchy for LAND projects
- **Used By:** Operations tab (LAND projects), `/projects/[projectId]/opex-accounts`
- **Features:** Account tree with numbers, names, totals, hierarchical indentation
- **Data Source:** `/api/projects/{id}/operating-expenses/hierarchy`

**NestedExpenseTable**
- **File:** `src/app/prototypes/multifam/rent-roll-inputs/components/NestedExpenseTable.tsx`
- **Purpose:** Hierarchical expense table for MF operating expenses
- **Used By:** Operations tab (MF projects)
- **Props:** `mode`, `rows`, `onToggleExpand`, `onUpdateExpense`, `selectedCategories`, `onCategoryFilterChange`, `onConfigureColumns`, `visibleColumns`
- **Features:**
  - Expand/collapse hierarchical rows
  - Inline editing (annual amount, escalation rate, recoverable flag)
  - Category filter chips (bg-600 colors with text-white)
  - Column configuration
  - Mode-aware field visibility

**BenchmarkPanel**
- **File:** `src/app/prototypes/multifam/rent-roll-inputs/components/BenchmarkPanel.tsx`
- **Purpose:** Market benchmark comparison for operating expenses
- **Used By:** Operations tab (MF projects)
- **Props:** `mode`, `totalPerUnit`, `marketMedian`, `alerts`
- **Features:** Variance calculation, alert severity display

**InventoryStatsPanel**
- **File:** `src/components/operations/InventoryStatsPanel.tsx`
- **Purpose:** Operating expense inventory statistics
- **Data Source:** `/api/projects/{id}/operating-expenses/inventory-stats`

**ModeToggle**
- **File:** `src/components/shared/ModeToggle.tsx`
- **Purpose:** Complexity mode selector (Napkin/Standard/Detail)
- **Used By:** `/projects/[projectId]/opex` standalone page
- **Props:** `mode`, `onModeChange`
- **Styling:** Three-button toggle group

**ConfigureColumnsModal**
- **File:** `src/app/projects/[projectId]/components/tabs/ConfigureColumnsModal.tsx`
- **Purpose:** Column visibility configuration for Operations tab
- **Props:** `isOpen`, `onClose`, `columns`, `onToggleColumn`, `currentMode`

### Valuation Components

**ComparablesGrid**
- **File:** `src/app/projects/[projectId]/valuation/components/ComparablesGrid.tsx`
- **Purpose:** Grid of comparable properties for sales comparison approach
- **Features:** Sorting, filtering, comparable selection

**ComparablesMap**
- **File:** `src/app/projects/[projectId]/valuation/components/ComparablesMap.tsx`
- **Purpose:** Map visualization of comparable properties
- **Uses:** MapLibre GL with markers for subject and comps

**IndicatedValueSummary**
- **File:** `src/app/projects/[projectId]/valuation/components/IndicatedValueSummary.tsx`
- **Purpose:** Summary of indicated value from selected comparables
- **Features:** Value calculation, adjustment summary

**LandscaperChatPanel**
- **File:** `src/app/projects/[projectId]/valuation/components/LandscaperChatPanel.tsx`
- **Purpose:** AI chat interface for valuation assistance
- **Features:** Chat history, AI-powered suggestions

**ProjectTabMap**
- **File:** `src/components/map/ProjectTabMap.tsx`
- **Purpose:** Map component for Property tab comparable rentals
- **Uses:** MapLibre GL for rental comp visualization

### Shared Components

**AreaTiles**
- **File:** `src/components/shared/AreaTiles.tsx`
- **Purpose:** Reusable area selection tiles
- **Used By:** Planning page, Sales & Absorption tab
- **Props:** `areas`, `selectedAreas`, `onAreaSelect`, `showCosts`
- **Features:** Multi-select, cost overlay display

**PhaseTiles**
- **File:** `src/components/sales/PhaseTiles.tsx`
- **Purpose:** Phase selection tiles with sales data
- **Used By:** Sales & Absorption tab
- **Props:** `phases`, `selectedPhases`, `onPhaseSelect`, `showCosts`
- **Features:** Multi-select, sales overlay display

### Data Entry & Forms
- `NewProjectModal` relies on React Hook Form + Zod, along with `AssetTypeSection`, `LocationSection`, etc.
- `ProfileForm` (DMS) handles metadata entry per document.
- `ProductLibraryPanel` uses local state and fetches for CRUD operations shared across `preferences`.

---

## 4. Styling System

### Frameworks
- **Tailwind CSS 3.4** â€“ utility classes applied throughout components (`tailwind.config.js` extends palette with CSS variables).
- **CoreUI 5** â€“ provides the base token system (`var(--cui-*)`) and components (cards, buttons, tables).
- **MUI 7** â€“ used by Materio prototypes and specific pages such as `/budget-grid`, `/projects/[projectId]/overview`.
- **Custom CSS:**
  - `src/app/globals.css` imports Tailwind layers plus custom overrides (table header backgrounds, focus indicators, planning tile specificity).
  - `src/styles/tokens.css` defines brand, surface, text, nav, and chip variables with light/dark scopes.
  - `src/styles/component-patterns.css` centralizes repeated patterns (accordion headers, planning tiles, budget rows, stat cards).

### Theme System
- `CoreUIThemeProvider` toggles `data-theme` and `data-coreui-theme`, ensuring CoreUI + custom CSS stay in sync.
- Dark mode defaults to `dark` on first load and persists to `localStorage('coreui-theme')`.
- Header color hierarchy documented in `docs/HEADER_COLOR_HIERARCHY.md` keeps `--surface-card-header` / `--surface-subheader` consistent.

### Design Tokens & Access
- Components reference CSS variables via inline styles (`style={{ backgroundColor: 'var(--cui-body-bg)' }}`) or Tailwind `text-[color]` classes.
- Tailwind config exposes extended colors bridging tokens to utilities (e.g., `bg-surface-card` resolves to `var(--surface-card)`).
- Spacing: mixture of Tailwind (`px-6 py-4`, `gap-3`) and CoreUI spacing tokens.
- Typography: CoreUI base fonts plus Tailwind `text-sm`, `font-semibold` classes.

### Responsive Breakpoints
- Tailwind defaults (`sm:640px`, `md:768px`, `lg:1024px`, `xl:1280px`) used frequently (e.g., Dashboard stat cards, GIS grid).
- MUI components rely on theme breakpoints for card layouts.

### Pattern Example
```tsx
<div className="data-card">
  <div className="data-card-header">Net Operating Income</div>
  <div className="data-card-value">$12.4M</div>
  <div className="data-card-subtitle">FY2025 Proforma</div>
</div>
```
`data-card*` classes derive from `src/styles/component-patterns.css` which in turn reference CoreUI variables, guaranteeing light/dark parity.

---

## 5. State Management

### Global Providers (see `src/app/layout.tsx:7`)
1. **QueryProvider** (`src/app/components/QueryProvider.tsx:1`)
   - Wraps `@tanstack/react-query` client with 30s stale time & disabled refetch on focus.
   - Used by future hooks that adopt React Query (most current data flows still use SWR or raw fetch).
2. **CoreUIThemeProvider** â€“ theme toggles described earlier.
3. **ToastProvider** â€“ Radix toast wrapper for consistent notifications (exported from `src/components/ui/toast`).
4. **ProjectProvider** â€“ handles project list and active context.
5. **IssueReporterProvider** â€“ houses bug reporter state.
6. **NavigationLayout** â€“ inserted after providers.

### Contexts
- **ComplexityModeProvider** (`src/contexts/ComplexityModeContext.tsx:1`): persists per-project global/ tab modes with localStorage, auto-saves after 1 second of inactivity.
- **ScenarioProvider** (`src/contexts/ScenarioContext.tsx:1`): loads `/api/financial/scenarios`, exposes CRUD methods, dispatches `window` events on scenario changes to notify other views.
- **Project Config Hook** (`src/hooks/useProjectConfig.ts:1`): uses SWR to fetch labeling and container hierarchy, returning maps keyed by IDs.
- **User Preferences** (`src/hooks/useUserPreferences.ts:1`): wraps REST API endpoints for storing preferences by scope; used by `ProjectContextBar` to show mode chips.

### Local State Patterns
- `useState` for tab selection (Project, DMS, Document Review) with occasional URL sync.
- `React Hook Form` + Zod for complex forms (New Project, Product Library, DMS profile forms).
- `useEffect` watchers for `localStorage` synchronization (Budget mode, Project mode, theme).

### Data Fetching
- **SWR** (`useSWR`) for `/api/projects`, `/api/parcels`, `/api/phases`, `/api/projects/{id}/config`, `/api/financial/scenarios`.
- **React Query** â€“ ready to adopt but not widely used yet.
- **Direct fetch** for module-scoped requests (Budget items, DMS filters, Benchmarks data, GIS APIs). Many of these should migrate to SWR/React Query for consistent caching.
- **Backend proxies** â€“ `PropertySummaryView` uses `NEXT_PUBLIC_BACKEND_URL`, GIS ingestion hits `/api/ai/ingest-property-package`.

### Error Handling
- Most fetch functions log errors and surface alerts/toasts; DMS and Product Library display inline toasts.
- Some prototypes simply log to console (e.g., `handleLandscaperMessage`).

---

## 6. Key User Flows

### Create New Project
1. User opens Dashboard and clicks the "New Project" tile.
2. `NewProjectModal` (`src/app/components/NewProjectModal.tsx:1`) opens with multi-section form tabs (Asset Type, Configure, Location, Property Data, Path Selection).
3. Form validations are enforced with Zod schema; file uploads restricted to approved extensions.
4. On submit, form payload hits `/api/projects` (or stub) and, upon success, `refreshProjects()` + `selectProject(projectId)` + `router.push(/projects/{id})` run sequentially.
5. Modal closes, ProjectContextBar shows the new project as active.

### Navigate Between Projects
1. User opens any `/projects/{id}` route and uses the dropdown inside `ProjectContextBar`.
2. `selectProject(newId)` updates context & localStorage.
3. Router pushes `/projects/{newId}` (without preserving `?tab`).
4. Downstream components consuming `useProjectContext` re-render; tabs re-read query param (default `project`).
5. Outside `projects/*`, there is no direct UIâ€”user must return to a project screen before switching (known limitation).

### Access Budget Data
1. From ProjectContextBar, user clicks the Budget tab, which pushes `?tab=budget`.
2. `BudgetTab` renders `BudgetContainer`, which defaults `activeSubTab` to `grid`.
3. `BudgetGridTab` mounts and loads data through `useBudgetData(projectId)` (`/api/budget/gantt`).
4. User toggles Napkin/Standard/Detail modes (persisted in `localStorage`), grouping, filters, or opens `BudgetItemModalV2` for editing.
5. Inline edits call `onInlineCommit` to hit `/api/budget/gantt/items/{factId}` and then `useBudgetData` refetches.

### Upload Document
1. From `/dms` or Documents tab, user selects the "Upload" tab.
2. `Dropzone` accepts drag-and-drop or file dialog, populating `uploadedFiles` state with pending entries.
3. Each file flows through statuses (pending â†’ uploading â†’ processing â†’ completed) with progress indicator and ability to edit metadata via `ProfileForm`.
4. On success, DMS displays processed documents in the queue and can switch back to Documents tab to view filter counts (after re-fetch triggered by `useEffect`).

### Generate Report
1. Navigate to `/reports` or Reports tab.
2. Choose scenario (Current/Proforma) and optionally another report type (Summary, Cash Flow, Rent Roll).
3. Component fetches metrics from backend; `PropertySummaryView` renders cards and tables.
4. Clicking "Download PDF" opens the respective backend endpoint in a new tab, handing off to browser PDF viewer.

### View/Edit Assumptions
1. In Budget tab, user switches to `AssumptionsTab` either via future sub-tab UI (currently manual state) or by toggling `activeSubTab`.
2. CoreUI form inputs allow editing default confidence, escalation, start period, duration.
3. Clicking "Save Assumptions" triggers simulated API call (placeholder) and surfaces alerts.
4. Once real endpoint is available, the pattern will align with other fetch calls (likely `/api/budget/assumptions`).

---

## 6A. API Routes Reference

This section documents key API endpoints used throughout the application, organized by feature area.

### Project-Specific Operating Expense APIs

| Endpoint | Method | Purpose |
|----------|--------|---------|
| `/api/projects/[projectId]/operating-expenses/hierarchy` | GET | Fetch Chart of Accounts hierarchy for project |
| `/api/projects/[projectId]/operating-expenses/[accountId]` | GET/PUT | Get/update individual account details |
| `/api/projects/[projectId]/operating-expenses/inventory-stats` | GET | Get inventory statistics for operating expenses |
| `/api/projects/[projectId]/opex` | GET/POST | Fetch or save operating expenses for project |

**Chart of Accounts Response Structure:**
```typescript
{
  accounts: Array<{
    account_number: string;
    account_name: string;
    calculated_total: number;
    children?: Array<Account>;
  }>;
}
```

**Account Number Mapping:**
- `5100-5120`: Taxes & Insurance (property_taxes, insurance)
- `5200-5220`: Utilities (utilities_combined, water_sewer, gas_electric)
- `5300-5320`: Payroll (property_management, payroll_onsite, payroll_offsite)
- `5400-5420`: Repairs & Maintenance (repairs_maintenance, unit_turnover, general_repairs)
- `5500-5550`: General & Administrative (other_operating, landscaping, trash_removal, pest_control, pool_amenity, administrative)

### Sales & Absorption APIs

| Endpoint | Method | Purpose |
|----------|--------|---------|
| `/api/projects/[projectId]/parcel-sales` | GET | Fetch parcel sales data |
| `/api/projects/[projectId]/parcel-sales/date` | GET | Fetch sales grouped by date |
| `/api/projects/[projectId]/parcels-with-sales` | GET | Fetch parcels with associated sales |
| `/api/projects/[projectId]/parcel-product-types` | GET | Fetch product types by parcel |
| `/api/projects/[projectId]/pricing-assumptions` | GET/POST | Fetch/save pricing assumptions |
| `/api/projects/[projectId]/pricing-assumptions/[id]` | PUT/DELETE | Update/delete pricing assumption |
| `/api/projects/[projectId]/sale-benchmarks` | GET | Fetch sale benchmarks for project |
| `/api/projects/[projectId]/inventory-gauge` | GET | Fetch inventory gauge data |
| `/api/projects/[projectId]/parcels/[parcelId]/calculate-sale` | POST | Calculate sale for specific parcel |
| `/api/projects/[projectId]/parcels/[parcelId]/sale-assumptions` | GET | Get sale assumptions for parcel |
| `/api/projects/[projectId]/parcels/[parcelId]/sale-benchmarks` | GET | Get sale benchmarks for parcel |

### Global Benchmark APIs

| Endpoint | Method | Purpose |
|----------|--------|---------|
| `/api/sale-benchmarks` | GET/POST | Fetch all sale benchmarks or create new |
| `/api/sale-benchmarks/[benchmarkId]` | GET/PUT/DELETE | Get/update/delete specific benchmark |

### Budget APIs

| Endpoint | Method | Purpose |
|----------|--------|---------|
| `/api/budget/gantt` | GET | Fetch budget gantt data (with `projectId` query param) |
| `/api/budget/gantt/items/[factId]` | PUT | Update individual budget item |
| `/api/budget/assumptions` | GET/POST | Fetch/save budget assumptions |

### Project & Configuration APIs

| Endpoint | Method | Purpose |
|----------|--------|---------|
| `/api/projects` | GET/POST | List all projects or create new |
| `/api/projects/[projectId]` | GET/PUT | Fetch/update project details |
| `/api/projects/[projectId]/config` | GET | Fetch project configuration (labels, hierarchy) |
| `/api/projects/[projectId]/containers` | GET | Fetch containers (areas/phases) |

### DMS APIs

| Endpoint | Method | Purpose |
|----------|--------|---------|
| `/api/dms/templates/doc-types` | GET | Fetch document type templates |
| `/api/dms/filters/counts` | GET | Fetch filter counts |
| `/api/dms/search` | GET | Search documents by filter |
| `/api/dms/upload` | POST | Upload new document |
| `/api/dms/templates` | GET/POST | Fetch/create document templates |

### Financial & Scenario APIs

| Endpoint | Method | Purpose |
|----------|--------|---------|
| `/api/financial/scenarios` | GET/POST | Fetch/create financial scenarios |
| `${NEXT_PUBLIC_BACKEND_URL}/api/reports/calculate/noi/[property]` | GET | Calculate NOI for property (backend service) |

### GIS & Planning APIs

| Endpoint | Method | Purpose |
|----------|--------|---------|
| `/api/parcels` | GET | Fetch parcels (with `project_id` query param) |
| `/api/phases` | GET | Fetch phases (with `project_id` query param) |
| `/api/gis/plan-parcels` | GET | Fetch GIS plan parcels |
| `/api/ai/ingest-property-package` | POST | AI property package ingestion |

---

## 6B. Complexity Mode System

### Overview

The Complexity Mode system allows users to switch between three levels of detail across multiple tabs:
- **Napkin Mode:** High-level, simplified view (minimal fields)
- **Standard Mode:** Balanced view with commonly-used fields
- **Detail Mode:** Comprehensive view with all available fields

### Implementation

**Provider:** `ComplexityModeProvider` (`src/contexts/ComplexityModeContext.tsx`)

**Storage:**
- Global mode stored in `localStorage` (`complexity_mode_{projectId}`)
- Tab-specific modes stored via `usePreference` hook (database-backed)
- Auto-saves after 1 second of inactivity

**Context Interface:**
```typescript
{
  globalMode: 'napkin' | 'standard' | 'detail';
  setGlobalMode: (mode: ComplexityTier) => void;
  getTabMode: (tabId: string) => ComplexityTier;
  setTabMode: (tabId: string, mode: ComplexityTier) => void;
}
```

### Tabs Supporting Modes

| Tab | Mode Support | Storage | Component |
|-----|-------------|---------|-----------|
| **Project** | âœ… Yes | `usePreference` | Shows `ModeChip` in tab button |
| **Planning** | âœ… Yes | `usePreference` | Shows `ModeChip` in tab button |
| **Budget** | âœ… Yes | `localStorage` | Shows `ModeChip` in tab button |
| **Operations** | âœ… Yes | `usePreference` | Shows `ModeChip` in tab button |
| **Property** | âœ… Yes | `usePreference` | Shows `ModeChip` in tab button |
| **Valuation** | âœ… Yes | `usePreference` | Shows `ModeChip` in tab button |
| **Sales** | âœ… Yes | `usePreference` | Shows `ModeChip` in tab button |
| **Feasibility** | âŒ No | N/A | No mode chip |
| **Capitalization** | âŒ No | N/A | No mode chip |
| **Reports** | âŒ No | N/A | No mode chip |
| **Documents** | âŒ No | N/A | No mode chip |

### Mode Indicators

**ModeChip Component:**
- **File:** `src/components/ui/ModeChip.tsx`
- **Display:** Small 20x20px square badge next to tab label
- **Colors:**
  - Napkin: Green (`--cui-success`)
  - Standard: Yellow (`--cui-warning`)
  - Detail: Red (`--cui-danger`)
- **Tooltip:** Shows full mode name on hover

### Field Visibility by Mode

**Operations Tab Example:**
```typescript
// Napkin Mode
visible: ['annual_amount', 'per_unit']

// Standard Mode
visible: ['annual_amount', 'per_unit', 'per_sf', 'escalation_rate']

// Detail Mode
visible: ['annual_amount', 'per_unit', 'per_sf', 'escalation_rate',
          'is_recoverable', 'recovery_rate']
```

### Mode Switching Behavior

**Data Preservation:**
- When switching from higher to lower complexity, current values are saved in history
- When switching back up, values are restored from history
- Restoration notice banner appears when values are restored
- History stored in component state during session

**Implementation (OperationsTab example):**
```typescript
const [savedValuesHistory, setSavedValuesHistory] = useState<{
  basic: Record<string, ExpenseData> | null;
  standard: Record<string, ExpenseData> | null;
  advanced: Record<string, ExpenseData> | null;
}>({ basic: null, standard: null, advanced: null });
```

---

## 6C. Chart of Accounts Integration

### Overview

The Chart of Accounts system provides hierarchical organization of operating expenses for multifamily projects, mapping GL account numbers to expense categories.

### Account Hierarchy Structure

**Account Number Format:** `XXXX` (4-digit codes)

**Top-Level Categories:**
1. **5100-5120: Taxes & Insurance**
   - 5100: Taxes & Insurance (parent)
   - 5110: Property Taxes
   - 5111: Real Estate Taxes
   - 5112: Personal Property Taxes
   - 5120: Insurance

2. **5200-5220: Utilities**
   - 5200: Utilities (parent)
   - 5210: Water & Sewer
   - 5220: Gas & Electric

3. **5300-5320: Payroll**
   - 5300: Property Management (parent)
   - 5310: Payroll - Onsite
   - 5320: Payroll - Offsite

4. **5400-5420: Repairs & Maintenance**
   - 5400: Repairs & Maintenance (parent)
   - 5410: Unit Turnover
   - 5420: General Repairs

5. **5500-5550: General & Administrative**
   - 5500: Other Operating (parent)
   - 5510: Landscaping
   - 5520: Trash Removal
   - 5530: Pest Control
   - 5540: Pool & Amenity
   - 5550: Administrative

### Account-to-Expense Type Mapping

**Implementation:** `OperationsTab.tsx` (lines 176-206)

```typescript
const accountToExpenseTypeMap: Record<string, { expenseType: string; category: string }> = {
  '5100': { expenseType: 'property_taxes', category: 'taxes' },
  '5110': { expenseType: 'property_taxes', category: 'taxes' },
  '5111': { expenseType: 'property_taxes', category: 'taxes' },
  '5112': { expenseType: 'property_taxes', category: 'taxes' },
  '5120': { expenseType: 'insurance', category: 'insurance' },
  '5200': { expenseType: 'utilities_combined', category: 'utilities' },
  '5210': { expenseType: 'water_sewer', category: 'utilities' },
  '5220': { expenseType: 'gas_electric', category: 'utilities' },
  // ... etc
};
```

### Flattening Hierarchical Accounts

When loading from `/api/projects/{id}/operating-expenses/hierarchy`, the hierarchical structure is flattened:

```typescript
const flattenAccounts = (accounts: any[]): ExpenseData[] => {
  const result: ExpenseData[] = [];

  accounts.forEach((account) => {
    const mapping = accountToExpenseTypeMap[account.account_number];

    if (mapping) {
      const annualAmount = parseFloat(account.calculated_total) || 0;
      result.push({
        expense_type: mapping.expenseType,
        expense_category: mapping.category,
        label: account.account_name,
        annual_amount: annualAmount,
        per_unit: propertyData?.unitCount ? annualAmount / propertyData.unitCount : 0,
        per_sf: propertyData?.totalSF ? annualAmount / propertyData.totalSF : 0,
        escalation_rate: 0.03, // Default 3%
        is_recoverable: false,
        recovery_rate: 0
      });
    }

    // Recursively process children
    if (account.children && account.children.length > 0) {
      result.push(...flattenAccounts(account.children));
    }
  });

  return result;
};
```

### Category Definitions for Filtering

**File:** `src/config/opex/hierarchical-structure.ts` (lines 259-265)

```typescript
export const CATEGORY_DEFINITIONS = [
  { key: 'taxes', label: 'TAXES', color: 'bg-red-600', textColor: 'text-white' },
  { key: 'insurance', label: 'INS', color: 'bg-blue-600', textColor: 'text-white' },
  { key: 'utilities', label: 'UTIL', color: 'bg-green-600', textColor: 'text-white' },
  { key: 'maintenance', label: 'R&M', color: 'bg-yellow-600', textColor: 'text-white' },
  { key: 'management', label: 'MGMT', color: 'bg-purple-600', textColor: 'text-white' },
  { key: 'other', label: 'OTHER', color: 'bg-gray-600', textColor: 'text-white' }
];
```

### Components Using Chart of Accounts

1. **OpExHierarchy** - Displays full account tree for LAND projects
2. **NestedExpenseTable** - Consumes flattened accounts for MF projects
3. **InventoryStatsPanel** - Shows account-level statistics

### Inventory Statistics

**Endpoint:** `/api/projects/{id}/operating-expenses/inventory-stats`

Provides aggregate statistics:
- Total accounts in chart
- Accounts with data
- Accounts missing data
- Percentage complete

---

## 7. Interactive Elements Catalog

### Buttons
- **Primary (filled):** Usually `LandscapeButton` with `color="primary"`.
- **Secondary:** `LandscapeButton` or `CButton` with `variant="outline"` or `ghost` when nested in tab lists.
- **Danger:** CoreUI `CButton color="danger"` used in modals (e.g., delete template) with strong red backgrounds.

Example:
```tsx
<LandscapeButton color="primary" icon={<CIcon icon={cilCloudUpload} />}>Import from Excel</LandscapeButton>
```

### Form Inputs
- **Text inputs:** CoreUI `CFormInput` for Budget/Assumptions, `Input` from shadcn/ui in Document Review, and MUI `TextField` in `BudgetGrid` prototype.
- **Number inputs:** Global CSS removes spinners; tailwind classes enforce consistent typography.
- **Selects:** `<select>` native elements in navigation bars, `CFormSelect` for forms, Radix `Select` in Document Review.
- **Date pickers:** Not yet standardized; prototypes rely on text inputs for now.

### Tables / Grids
- **CoreUI tables:** Dashboard, Reports, DMS detail lists.
- **TanStack tables:** `BudgetDataGrid` handles virtualization, column grouping, inline editing.
- **MUI tables:** `BudgetGrid` prototype uses `Table`, `TableRow`, etc.

### Modals / Dialogs
- **CoreUI `CModal`:** Budget item editor, Quick Add Category, general info modals.
- **Radix Dialog:** Document Review uses `CorrectionModal` (shadcn) for editing fields.
- **Custom overlays:** `LandscaperChatModal` is controlled by `TopNavigationBar` state.

### Dropdowns / Menus
- `SandboxDropdown`, `UserMenuDropdown`, `SettingsDropdown` share the same outside-click pattern and manually manage open/close states.
- DMS filter accordions behave like dropdowns with icon toggles and asynchronous lazily-loaded body.

### Tabs
- Primary surfaces listed in Section 1.6. Most replicates revolve around `LandscapeButton` or CoreUI `CNav` and track state in React. Document Review is the only implementation using Radix `Tabs` for keyboard-supporting toggles out of the box.

### Other Patterns
- **Accordions:** `AccordionFilters` use custom data plus icons; `BenchmarkAccordion` uses CoreUI collapse widgets.
- **Cards:** `data-card` CSS pattern ensures consistent background, border, and type scale for stat cards.
- **Tiles:** Planning uses `.planning-tile` CSS rules to maintain borders, colors, and active state overrides.

---

## 8. Responsive Behavior

### Breakpoint Strategy
- **Desktop-first:** Layouts are designed for 1440 px wide monitors. Top nav, tab bars, and tables assume wide screens and degrade by overflowing rather than reflowing.
- **Tailwind Media Queries:** Many grids use `md:grid-cols-2` or `lg:grid-cols-4` to distribute cards (e.g., Dashboard stats, GIS component selector).
- **MUI Breakpoints:** Prototypes leverage `md`, `lg` props for column spans.

### Component-specific Notes
- **TopNavigationBar:** Stays sticky across breakpoints but lacks collapse mechanism; nav items compress, causing the "clumsy" feel on tablet widths.
- **ProjectContextBar:** Buttons overflow horizontally on <1200 px; no scroll container is provided, so tabs wrap to a second line.
- **Tables:** CoreUI tables add `responsive` wrappers to provide horizontal scroll on smaller screens; Budget grid uses `table-responsive` to show scrollbars when width insufficient.
- **DMS Layout:** Uses `flex-col` and `flex-row` combos. On mobile, the dual-column filter list will stack, but the detail view (when open) can push content below the fold.
- **GIS Workflow:** `grid-cols-2 lg:grid-cols-4` ensures component cards wrap gracefully.

### Recommendations for Redesign
- Introduce a global responsive nav pattern (hamburger/drawer or tile-based chips) to ease the top-level clumsy experience.
- Convert `ProjectContextBar` to a scrollable chip row or multi-line tile grid as part of the planned redesign.
- Provide accessible project switcher outside `/projects/*` routes (e.g., inside `TopNavigationBar`).

---

## 9. Performance Considerations

- **Code Splitting:** Next.js App Router automatically code-splits per route. `preferences/page.tsx` leverages `next/dynamic` to lazy-load heavy Product Library/Taxonomy components.
- **Data Virtualization:** `BudgetDataGrid` uses TanStack Table and optional virtualization for rows (React Table + TanStack Virtual), while `/budget-grid` prototype uses `useVirtualizer`.
- **Caching:** SWR caches project lists, parcels, phases, and scenarios. React Query provider is in place for future adoption but not yet widely used.
- **Polling:** Some components poll localStorage (`ProjectContextBar` for budget mode). Consider moving to preference API to eliminate intervals.
- **MapLibre:** GIS components load map tiles lazily and clean up map instances on component unmount.
- **Lazy Data Fetches:** Accordion filters fetch document lists only when expanded; DMS counts are aggregated to minimize API chatter. Benchmarks page loads multiple endpoints concurrently using `Promise.all`.

---

## 10. Accessibility

- **Focus Styles:** `src/app/globals.css` enforces custom `outline` and `box-shadow` for `:focus-visible` on all interactive elements (WCAG 2.1 AA compliance for visible focus indicators).
- **ARIA / Semantics:**
  - `PageHeader` uses `<nav aria-label="breadcrumb">` and `aria-current` markers.
  - `TopNavigationBar` buttons carry `aria-label`s for theme and bug reporter.
  - `ModeChip` exposes `role="status"` + `aria-label`.
  - `Tabs` in Document Review use Radix (with keyboard nav + ARIA attributes out of the box).
- **Screen Reader Considerations:** Many buttons rely on iconography without `aria-label` (e.g., DMS toolbar); those should be wrapped as part of the redesign.
- **Color Contrast:** Tokens defined in `tokens.css` are tuned for dark/light parity per `docs/HEADER_COLOR_HIERARCHY.md`, but manual inline colors (e.g., `text-gray-400` on dark backgrounds) should be audited.
- **Keyboard Navigation:** Drop-downs close on outside click but not on `Esc`; consider adding key handlers.

---

## Appendix A: File Structure

```
src/
â”œâ”€â”€ app
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”œâ”€â”€ page.tsx (redirect)
â”‚   â”œâ”€â”€ components
â”‚   â”‚   â”œâ”€â”€ NavigationLayout.tsx
â”‚   â”‚   â”œâ”€â”€ TopNavigationBar.tsx
â”‚   â”‚   â”œâ”€â”€ ProjectContextBar.tsx
â”‚   â”‚   â”œâ”€â”€ OpExHierarchy.tsx (Chart of Accounts for LAND)
â”‚   â”‚   â”œâ”€â”€ navigation/ (SandboxDropdown, UserMenuDropdown, SettingsDropdown)
â”‚   â”‚   â”œâ”€â”€ dashboard/ (UserTile, DashboardMap)
â”‚   â”‚   â”œâ”€â”€ Planning/ (PlanningContent, CollapsibleSection, etc.)
â”‚   â”‚   â”œâ”€â”€ GIS/ (GISSetupWorkflow, PlanNavigation, etc.)
â”‚   â”‚   â””â”€â”€ layout/vertical/ (Materio sidebar)
â”‚   â”œâ”€â”€ dashboard/page.tsx
â”‚   â”œâ”€â”€ dms/page.tsx
â”‚   â”œâ”€â”€ planning/page.tsx
â”‚   â”œâ”€â”€ reports/page.tsx
â”‚   â”œâ”€â”€ rent-roll/page.tsx
â”‚   â”œâ”€â”€ documents/review/page.tsx
â”‚   â”œâ”€â”€ ai-document-review/page.tsx
â”‚   â”œâ”€â”€ projects
â”‚   â”‚   â”œâ”€â”€ [projectId]
â”‚   â”‚   â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx (tab host)
â”‚   â”‚   â”‚   â”œâ”€â”€ overview/page.tsx (legacy Materio)
â”‚   â”‚   â”‚   â”œâ”€â”€ budget/page.tsx (standalone)
â”‚   â”‚   â”‚   â”œâ”€â”€ valuation/page.tsx (standalone)
â”‚   â”‚   â”‚   â”œâ”€â”€ assumptions/page.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ settings/page.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ opex/page.tsx (MF operating expenses)
â”‚   â”‚   â”‚   â”œâ”€â”€ opex-accounts/page.tsx (Chart of Accounts viewer)
â”‚   â”‚   â”‚   â”œâ”€â”€ components/tabs/ (OperationsTab, SalesTab, PropertyTab, etc.)
â”‚   â”‚   â”‚   â””â”€â”€ valuation/components/ (ComparablesGrid, ComparablesMap, etc.)
â”‚   â”‚   â””â”€â”€ setup/page.tsx
â”‚   â”œâ”€â”€ admin
â”‚   â”‚   â”œâ”€â”€ benchmarks/page.tsx
â”‚   â”‚   â”œâ”€â”€ benchmarks/cost-library/page.tsx
â”‚   â”‚   â”œâ”€â”€ preferences/page.tsx
â”‚   â”‚   â””â”€â”€ dms
â”‚   â”‚       â””â”€â”€ templates/page.tsx
â”‚   â”œâ”€â”€ preferences/page.tsx
â”‚   â”œâ”€â”€ settings
â”‚   â”‚   â”œâ”€â”€ taxonomy/page.tsx
â”‚   â”‚   â””â”€â”€ budget-categories/page.tsx
â”‚   â”œâ”€â”€ benchmarks
â”‚   â”‚   â”œâ”€â”€ unit-costs/page.tsx
â”‚   â”‚   â””â”€â”€ products/page.tsx
â”‚   â”œâ”€â”€ growthrates/page.tsx
â”‚   â”œâ”€â”€ growthrates-original/page.tsx
â”‚   â”œâ”€â”€ growthratedetail/page.tsx
â”‚   â”œâ”€â”€ growthratesmanager/page.tsx
â”‚   â”œâ”€â”€ prototypes
â”‚   â”‚   â”œâ”€â”€ page.tsx (prototypes hub)
â”‚   â”‚   â”œâ”€â”€ [prototypeId]/page.tsx
â”‚   â”‚   â””â”€â”€ multifam
â”‚   â”‚       â””â”€â”€ rent-roll-inputs
â”‚   â”‚           â”œâ”€â”€ page.tsx
â”‚   â”‚           â”œâ”€â”€ content/page.tsx
â”‚   â”‚           â””â”€â”€ components/ (NestedExpenseTable, BenchmarkPanel, etc.)
â”‚   â”œâ”€â”€ prototypes-multifam/page.tsx
â”‚   â”œâ”€â”€ db-schema/page.tsx
â”‚   â”œâ”€â”€ test-coreui/page.tsx
â”‚   â”œâ”€â”€ lease/[id]/page.tsx (legacy)
â”‚   â”œâ”€â”€ property/[id]/page.tsx (legacy)
â”‚   â””â”€â”€ properties/[id]/analysis/page.tsx (legacy)
â”œâ”€â”€ components
â”‚   â”œâ”€â”€ budget/ (BudgetDataGrid, BudgetGridTab, modals, hooks)
â”‚   â”œâ”€â”€ dms/ (DMSView, Dropzone, Queue, ProfileForm, etc.)
â”‚   â”œâ”€â”€ operations/ (InventoryStatsPanel, OpExModeSelector)
â”‚   â”œâ”€â”€ ui/ (PageHeader, LandscapeButton, ModeChip, toast)
â”‚   â”œâ”€â”€ ui/landscape/ (LandscapeButton)
â”‚   â”œâ”€â”€ project/ (ProjectProfileTile)
â”‚   â”œâ”€â”€ shared/ (ModeToggle, AreaTiles)
â”‚   â”œâ”€â”€ sales/ (PhaseTiles, PricingTable, ParcelSalesTable, etc.)
â”‚   â”œâ”€â”€ benchmarks/ (BenchmarkAccordion, GrowthRateCategoryPanel, unit-costs)
â”‚   â”œâ”€â”€ taxonomy/ (FamilyTree, FamilyDetails, ProductsList)
â”‚   â”œâ”€â”€ map/ (ProjectTabMap, MapOblique, ValuationSalesCompMap)
â”‚   â”œâ”€â”€ reports/ (PropertySummaryView)
â”‚   â””â”€â”€ extraction/ (StagingModal)
â”œâ”€â”€ contexts
â”‚   â”œâ”€â”€ ComplexityModeContext.tsx
â”‚   â””â”€â”€ ScenarioContext.tsx
â”œâ”€â”€ hooks
â”‚   â”œâ”€â”€ useUserPreferences.ts
â”‚   â”œâ”€â”€ useProjectConfig.ts
â”‚   â””â”€â”€ useContainers.ts
â”œâ”€â”€ config
â”‚   â””â”€â”€ opex
â”‚       â”œâ”€â”€ hierarchical-structure.ts (CATEGORY_DEFINITIONS)
â”‚       â””â”€â”€ multifamily-fields.ts
â”œâ”€â”€ lib
â”‚   â”œâ”€â”€ utils/projectTabs.ts (getTabsForPropertyType)
â”‚   â””â”€â”€ api/user-preferences.ts
â”œâ”€â”€ styles
â”‚   â”œâ”€â”€ tokens.css
â”‚   â”œâ”€â”€ component-patterns.css
â”‚   â”œâ”€â”€ coreui-theme.css
â”‚   â””â”€â”€ app/globals.css
â””â”€â”€ docs
    â”œâ”€â”€ HEADER_COLOR_HIERARCHY.md
    â””â”€â”€ LANDSCAPE_UI_TECHNICAL_OVERVIEW.md
```

---

## Appendix B: UI Dependencies

| Package | Purpose |
| --- | --- |
| `@coreui/react`, `@coreui/icons-react`, `@coreui/coreui` | Primary component + token library used across Dashboard, tabs, tables. |
| `@mui/material`, `@mui/icons-material`, `@menu/vertical-menu` | Materio theme components powering Budget Grid prototype and legacy overview pages. |
| `@radix-ui/react-*` (tabs, select, dialog, toast, tooltip) | Interaction primitives used in Document Review, shadcn-based components. |
| `@tanstack/react-table`, `@tanstack/react-virtual` | Budget grid table and virtualization. |
| `@tanstack/react-query` | Query provider (ready for adoption). |
| `swr` | Data fetching for projects, planning, scenarios. |
| `maplibre-gl`, `@types/maplibre-gl`, `@turf/turf` | GIS map rendering, geometry utilities. |
| `@hookform/resolvers`, `react-hook-form`, `zod` | Complex form validation (NewProjectModal, Product Library). |
| `lucide-react`, `@coreui/icons` | Iconography for nav, buttons, analytics. |
| `tailwindcss`, `@tailwindcss/forms`, `@tailwindcss/typography`, `tailwindcss-animate` | Utility classes, form normalization, animation. |
| `@heroicons/react` | Occasional icons in DMS and Planning surfaces. |
| `@uploadthing/react`, `react-dropzone` | File upload experiences in DMS. |

All other dependencies in `package.json` either serve backend API calls (e.g., `pdf-parse`, `xlsx`) or non-UI prototypes (benchmarks importers).
