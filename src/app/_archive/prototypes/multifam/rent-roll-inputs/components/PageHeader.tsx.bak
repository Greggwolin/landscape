'use client';

import React from 'react';
import { useProjectContext } from '@/app/components/ProjectProvider';
import { ModeToggle } from '@/components/shared/ModeToggle';
import { ComplexityTier } from '@/contexts/ComplexityModeContext';
import { Button } from '@mui/material';
import UploadIcon from '@mui/icons-material/Upload';

interface PageHeaderProps {
  projectName: string;
  projectId: number;
  mode: ComplexityTier;
  onModeChange: (mode: ComplexityTier) => void;
  fieldCounts: { basic: number; standard: number; advanced: number };
  onUploadClick?: () => void;
  uploading?: boolean;
}

export function PageHeader({
  projectName: _projectName,
  projectId,
  mode,
  onModeChange,
  fieldCounts,
  onUploadClick,
  uploading = false
}: PageHeaderProps) {
  const { activeProject, projects } = useProjectContext();
  const currentProject = projects.find(p => p.project_id === projectId) || activeProject;

  return (
    <div className="tw-bg-gray-900 tw-border-b tw-border-gray-700 px-8 py-4">
      <div className="tw-flex tw-items-center tw-justify-between">
        <div className="tw-flex tw-items-center gap-4">
          {/* Project Selector */}
          <select
            value={currentProject?.project_id || projectId}
            onChange={(e) => {
              const newProjectId = Number(e.target.value);
              window.location.href = `/projects/${newProjectId}/overview`;
            }}
            className="px-3 py-2 tw-text-sm tw-font-semibold rounded focus:outline-none tw-cursor-pointer tw-bg-gray-800 border tw-border-gray-700 text-white"
          >
            <option value="">Select a project</option>
            {projects.map((project) => (
              <option key={project.project_id} value={project.project_id}>
                {project.project_name} - {project.project_type_code || 'Unknown Type'}
              </option>
            ))}
          </select>
        </div>

        <div className="tw-flex tw-items-center gap-3">
          {onUploadClick && (
            <Button
              variant="contained"
              color="primary"
              startIcon={<UploadIcon />}
              onClick={onUploadClick}
              disabled={uploading}
              size="small"
            >
              {uploading ? 'Processing...' : 'Upload Rent Roll'}
            </Button>
          )}

          <ModeToggle
            currentMode={mode}
            availableModes={['basic', 'standard', 'advanced']}
            onChange={onModeChange}
            showFieldCounts={true}
            fieldCounts={fieldCounts}
            size="md"
            theme="dark"
          />
        </div>
      </div>
    </div>
  );
}
