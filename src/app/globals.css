/* MapLibre GL CSS - must be first */
@import 'maplibre-gl/dist/maplibre-gl.css';
/* Leaflet base styles for the GIS page */
@import 'leaflet/dist/leaflet.css';
@import '../styles/tokens.css';
@import '../styles/component-patterns.css';
@import '../styles/folder-tabs.css';
@import '../styles/property-page.css';
@import '../styles/loan-schedule.css';
@import '../styles/leveraged-cf.css';

/* MapLibre popup styles */
.maplibregl-popup {
  z-index: 9999 !important;
}

.maplibregl-popup-content {
  background: var(--cui-card-bg) !important;
  color: var(--cui-body-color) !important;
  border-radius: 8px !important;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.35) !important;
  padding: 0 !important;
  border: 1px solid var(--cui-card-border-color) !important;
}

.maplibregl-popup-tip {
  border-top-color: var(--cui-card-bg) !important;
}

.maplibregl-popup-close-button {
  color: var(--cui-secondary-color) !important;
  font-size: 18px !important;
  padding: 4px 8px !important;
}

.maplibregl-popup-close-button:hover {
  color: var(--cui-body-color) !important;
  background: transparent !important;
}

.map-marker-popup .maplibregl-popup-content {
  background: var(--cui-card-bg) !important;
}

/* MapLibre control theming */
.maplibregl-ctrl-group {
  background: var(--cui-card-bg) !important;
  border: 1px solid var(--cui-border-color) !important;
}

.maplibregl-ctrl-group button {
  background-color: transparent !important;
  border-color: var(--cui-border-color) !important;
}

.maplibregl-ctrl-group button:hover {
  background-color: var(--cui-tertiary-bg) !important;
}

[data-coreui-theme='dark'] .maplibregl-ctrl-group button span,
[data-coreui-theme='dark'] .maplibregl-ctrl-group button .maplibregl-ctrl-icon {
  filter: invert(0.9);
}

.maplibregl-ctrl-scale {
  background: var(--cui-card-bg) !important;
  border-color: var(--cui-border-color) !important;
  color: var(--cui-body-color) !important;
  font-size: 10px !important;
}

@tailwind base;
@tailwind components;
@tailwind utilities;

/* Override planning-tile styles with maximum specificity */
@layer utilities {
  .planning-tile-active {
    color: var(--cui-body-color) !important;
  }

  .planning-tile-header {
    color: var(--cui-body-color) !important;
  }

  .planning-tile.planning-tile-active .planning-tile-header,
  .planning-tile-active .planning-tile-header,
  div.planning-tile-active .planning-tile-header,
  div.planning-tile-active > .planning-tile-header {
    color: var(--cui-body-color) !important;
  }

  /* Budget group rows - maintain background */
  tr.budget-group-row[data-group-row="true"],
  tr.budget-group-row[data-group-row="true"] td,
  tr[data-group-row="true"],
  tr[data-group-row="true"] td,
  .budget-group-row,
  .budget-group-row td {
    background-color: var(--surface-subheader) !important;
  }

  tr.budget-group-row[data-group-row="true"]:hover,
  tr.budget-group-row[data-group-row="true"]:hover td,
  tr[data-group-row="true"]:hover,
  tr[data-group-row="true"]:hover td,
  .budget-group-row:hover,
  .budget-group-row:hover td {
    background-color: var(--surface-subheader) !important;
    filter: brightness(0.97);
  }
}

/* Override ALL table headers globally - must be outside @layer to avoid Tailwind conflicts */
thead,
thead tr,
thead th {
  background-color: var(--surface-card-header) !important;
}

/* Nuclear option: Maximum specificity with element selectors */
div.planning-tile.planning-tile-active,
div.planning-tile.planning-tile-active *,
div.planning-tile-active,
div.planning-tile-active * {
  color: var(--cui-body-color) !important;
}

div.planning-tile-header,
div.planning-tile.planning-tile-active div.planning-tile-header,
.planning-tile-active > .planning-tile-header,
.planning-tile-active .planning-tile-header {
  color: var(--cui-body-color) !important;
}

:root {
  --background: var(--surface-bg);
  --foreground: var(--text-primary);
}

.dark {
  --background: var(--surface-bg);
  --foreground: var(--text-primary);
}

/* Universal spacing + layout helpers */
.app-shell {
  padding: var(--app-padding);
  display: flex;
  flex-direction: column;
  gap: var(--component-gap);
}

.app-page,
.app-content,
.app-stack {
  display: flex;
  flex-direction: column;
  gap: var(--component-gap);
}

.capitalization-panel {
  background-color: #ffffff !important;
  align-self: stretch;
  min-height: 100%;
}

.card,
.panel {
  margin-bottom: var(--component-gap);
}

.section-spacing {
  margin-bottom: var(--component-gap);
}

@theme inline {
  --color-background: var(--surface-bg);
  --color-foreground: var(--text-primary);
  --font-sans: var(--font-geist-sans);
  --font-mono: var(--font-geist-mono);
}

body {
  background: var(--surface-bg);
  color: var(--text-primary);
  font-family: Arial, Helvetica, sans-serif;
  transition: background-color 0.3s ease, color 0.3s ease;
}

/* Remove spinners from number inputs */
input[type="number"]::-webkit-inner-spin-button,
input[type="number"]::-webkit-outer-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

input[type="number"] {
  -moz-appearance: textfield;
  appearance: textfield;
}

/* Force all dropdown and input styling */
.parcel-inline-select,
.parcel-inline-input,
select[class*='parcel-inline'],
input[class*='parcel-inline'] {
  color: var(--text-primary) !important;
  -webkit-text-fill-color: var(--text-primary) !important;
  background-color: var(--surface-card) !important;
  color-scheme: light !important;
  -webkit-appearance: menulist !important;
  appearance: menulist !important;
  border: 1px solid var(--line-strong) !important;
  line-height: 1.2 !important;
  padding: 2px 4px !important;
  font-size: 12px !important;
}

/* Target option elements with maximum specificity */
.parcel-inline-select option,
select.parcel-inline-select option,
select[class*='parcel-inline'] option,
option {
  color: var(--text-primary) !important;
  background-color: var(--surface-card) !important;
  -webkit-text-fill-color: var(--text-primary) !important;
  background: var(--surface-card) !important;
}

/* Force all states of select elements */
select.parcel-inline-select,
select.parcel-inline-select:focus,
select.parcel-inline-select:active,
select.parcel-inline-select:hover,
select.parcel-inline-select:visited,
select[class*='parcel-inline'] {
  color: var(--text-primary) !important;
  -webkit-text-fill-color: var(--text-primary) !important;
  background-color: var(--surface-card) !important;
  background: var(--surface-card) !important;
}

/* Override any inherited styles from parent containers */
.parcel-inline-select *,
select[class*='parcel-inline'] * {
  color: var(--text-primary) !important;
  -webkit-text-fill-color: var(--text-primary) !important;
}

/* Global option override for dropdown visibility */
div[class*='planning'] select option,
div[class*='wizard'] select option,
div[class*='parcel'] select option {
  color: var(--text-primary) !important;
  background-color: var(--surface-card) !important;
  -webkit-text-fill-color: var(--text-primary) !important;
}

/* ===== ACCESSIBILITY: Focus Indicators (Phase 1 - v1.0) ===== */
/* WCAG 2.1 AA Compliance: Visible focus indicators on all interactive elements */

/* Primary focus style for all interactive elements */
button:focus-visible,
a:focus-visible,
input:focus-visible,
select:focus-visible,
textarea:focus-visible,
[role="button"]:focus-visible,
[role="link"]:focus-visible,
[role="tab"]:focus-visible,
[tabindex]:not([tabindex="-1"]):focus-visible {
  outline: 2px solid var(--brand-primary);
  outline-offset: 2px;
  transition: outline 0.1s ease-in-out;
}

/* Enhanced focus for form controls (additional ring for visibility) */
input:focus-visible,
select:focus-visible,
textarea:focus-visible {
  box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.2);
}

/* Focus for CoreUI components (they inherit base styles automatically) */
.btn:focus-visible,
.form-control:focus-visible,
.form-select:focus-visible {
  outline: 2px solid var(--brand-primary);
  outline-offset: 2px;
}

/* Remove default browser focus styles (we're replacing with custom) */
button:focus:not(:focus-visible),
a:focus:not(:focus-visible),
input:focus:not(:focus-visible),
select:focus:not(:focus-visible),
textarea:focus:not(:focus-visible) {
  outline: none;
}

/* Ensure keyboard navigation is visible in tables */
table tbody tr:focus-visible,
.table tbody tr:focus-visible {
  outline: 2px solid var(--brand-primary);
  outline-offset: -2px;
}

/* Focus for custom interactive components */
[data-interactive="true"]:focus-visible,
.interactive:focus-visible {
  outline: 2px solid var(--brand-primary);
  outline-offset: 2px;
}
